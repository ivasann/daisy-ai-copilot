<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DAISY - Your Personal AI Life Copilot</title>
    <link rel="icon" href="assets/favicon.svg" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;500;600;700;800&family=Poppins:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Nunito', 'sans-serif'],
                        display: ['Poppins', 'Nunito', 'sans-serif'],
                    },
                    colors: {
                        primary: '#FF4D6D',
                        secondary: '#F5F5F7',
                        accent: '#0B0B0D',
                        dark: '#0B0B0D',
                        light: '#FFFFFF',
                    },
                    animation: {
                        'fade-in': 'fadeIn 1s ease-out',
                        'slide-up': 'slideUp 0.8s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        .glass {
            background: rgba(255, 255, 255, 0.72);
            backdrop-filter: blur(18px);
            border: 1px solid rgba(15, 15, 18, 0.06);
            box-shadow: 0 12px 40px -18px rgba(0, 0, 0, 0.18);
        }

        /* Apple Health Style Pastel Gradients */
        .bg-pastel-blue {
            background: linear-gradient(135deg, #E0F2FE 0%, #BAe6FD 100%);
        }

        .bg-pastel-pink {
            background: linear-gradient(135deg, #FCE7F3 0%, #FBCFE8 100%);
        }

        .bg-pastel-green {
            background: linear-gradient(135deg, #DCFCE7 0%, #BBF7D0 100%);
        }

        .bg-pastel-purple {
            background: linear-gradient(135deg, #F3E8FF 0%, #E9D5FF 100%);
        }

        .bg-pastel-orange {
            background: linear-gradient(135deg, #FFEDD5 0%, #FED7AA 100%);
        }

        .bg-pastel-cyan {
            background: linear-gradient(135deg, #E0F7FA 0%, #B2EBF2 100%);
        }

        .bg-pastel-indigo {
            background: linear-gradient(135deg, #E0E7FF 0%, #C7D2FE 100%);
        }

        .bg-pastel-rose {
            background: linear-gradient(135deg, #FFE4E6 0%, #FECDD3 100%);
        }

        .bg-pastel-yellow {
            background: linear-gradient(135deg, #FEF9C3 0%, #FEF08A 100%);
        }

        /* Apple Style Typography & Spacing */
        .text-apple {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Arial, sans-serif;
            letter-spacing: -0.012em;
        }

        .ios-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
        }

        .ios-shadow-lg {
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.04), 0 1px 4px rgba(0, 0, 0, 0.02);
        }

        .shadow-yellow-glow {
            box-shadow: 0 0 50px -10px rgba(246, 234, 194, 0.5);
        }

        .apple-active-glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.15);
        }

        /* Isolated Focus Mode Styles */
        .focus-apple-card {
            background: #F9F4E0;
            /* Cream/Beige from screenshot */
            border-radius: 48px;
        }

        /* Virtual Workspace Styles */
        #neuralWorkspace {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: #f6f2ec;
            display: none;
            overflow-y: auto;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #neuralWorkspace.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        #neuralWorkspace.pomo-active {
            overflow: hidden !important;
        }

        #neuralWorkspace.pomo-active .nw-header {
            display: none !important;
        }

        #neuralWorkspace.pomo-active .nw-shell {
            padding: 0 !important;
            max-width: 100% !important;
            width: 100% !important;
        }

        #neuralWorkspace.pomo-active .nw-grid {
            padding: 0 !important;
            margin: 0 !important;
        }

        .neural-loader {
            position: fixed;
            inset: 0;
            z-index: 10000;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .neural-loader.active {
            opacity: 1;
            pointer-events: auto;
        }

        .dna-helix {
            display: flex;
            gap: 4px;
            height: 40px;
        }

        .dna-bar {
            width: 3px;
            height: 100%;
            background: var(--primary);
            border-radius: 10px;
            animation: dna-bounce 1s ease-in-out infinite;
        }

        @keyframes dna-bounce {

            0%,
            100% {
                transform: scaleY(0.5);
                opacity: 0.3;
            }

            50% {
                transform: scaleY(1);
                opacity: 0.8;
            }
        }

        /* Breathe Animation */
        .breathe-circle {
            animation: breathe 8s ease-in-out infinite;
        }

        @keyframes breathe {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.3;
            }

            50% {
                transform: scale(1.4);
                opacity: 0.1;
            }
        }

        .sound-active {
            color: #007AFF !important;
            background: rgba(0, 122, 255, 0.1) !important;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        .workspace-content {
            padding: 4rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Neural Workspace Redesign */
        #neuralWorkspace {
            --nw-ink: #f5f6f7;
            --nw-muted: rgba(245, 246, 247, 0.6);
            --nw-line: rgba(255, 255, 255, 0.12);
            --nw-surface: #1b1f2a;
            --nw-surface-2: #202534;
            --nw-accent: #7aa6ff;
            color: var(--nw-ink);
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Arial, sans-serif;
        }

        #neuralWorkspace.session-active {
            background: #f5f6f8;
        }

        #neuralWorkspace.session-complete .nw-panel {
            box-shadow: 0 0 24px -18px rgba(122, 166, 255, 0.45);
        }

        .nw-bg {
            position: absolute;
            inset: 0;
            background: var(--pomo-bg, #ffffff);
            transition: background 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            z-index: -1;
        }

        .nw-bg::before,
        .nw-bg::after {
            content: '';
            position: absolute;
            width: 800px;
            height: 800px;
            border-radius: 50%;
            filter: blur(120px);
            opacity: 0.6;
            z-index: 0;
            animation: orbFloat 20s infinite alternate ease-in-out;
            transition: background 1s ease;
        }

        .nw-bg::before {
            content: "";
            position: absolute;
            inset: 0;
            background:
                radial-gradient(circle at 20% 30%, rgba(0, 113, 227, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(106, 166, 255, 0.1) 0%, transparent 50%);
            filter: blur(60px);
            opacity: 0.6;
        }

        #neuralWorkspace.session-active .nw-bg::before {
            background:
                radial-gradient(circle at 30% 40%, rgba(0, 113, 227, 0.2) 0%, transparent 40%),
                radial-gradient(circle at 70% 60%, rgba(106, 166, 255, 0.15) 0%, transparent 40%);
            opacity: 0.8;
        }

        .nw-shell {
            position: relative;
            z-index: 2;
            max-width: 1040px;
            margin: 0 auto;
            padding: 60px 24px 72px;
        }

        .nw-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 28px;
        }

        .nw-status {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            border-radius: 999px;
            background: var(--nw-surface-2);
            border: 1px solid var(--nw-line);
        }

        .nw-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: rgba(15, 17, 21, 0.35);
        }

        .nw-kicker {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.32em;
            color: rgba(15, 17, 21, 0.45);
        }

        .nw-title {
            font-size: 18px;
            font-weight: 600;
            letter-spacing: -0.02em;
        }

        .nw-grid {
            display: grid;
            gap: 24px;
        }

        .nw-panel {
            background: var(--nw-surface);
            border: 1px solid var(--nw-line);
            border-radius: 20px;
            padding: 28px;
        }

        /* Immersive Focus Mode */
        #neuralWorkspace.nw-immersive .nw-shell {
            max-width: 100%;
            padding: 0;
        }

        #neuralWorkspace.nw-immersive .nw-header {
            display: none;
        }

        #neuralWorkspace.nw-immersive #focusModePanel {
            min-height: 100vh;
            height: 100vh;
            width: 100%;
            border-radius: 0;
            border: none;
            padding: 64px 8vw;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: transparent;
        }

        .nw-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 24px;
        }

        .nw-heading {
            font-size: 28px;
            font-weight: 650;
            letter-spacing: -0.03em;
        }

        .nw-pill {
            padding: 8px 16px;
            border-radius: 999px;
            border: 1px solid var(--nw-line);
            background: var(--nw-surface-2);
        }

        .nw-pill-text {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.28em;
            color: var(--nw-muted);
        }

        .nw-focus-grid {
            display: grid;
            grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
            gap: 24px;
            align-items: center;
        }

        .nw-timer-value {
            font-size: 60px;
            font-weight: 650;
            letter-spacing: -0.04em;
            color: var(--nw-ink);
        }

        .nw-progress {
            width: 220px;
            height: 6px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.12);
            overflow: hidden;
            margin: 14px auto 0;
        }

        .nw-progress-bar {
            height: 100%;
            width: 0%;
            background: var(--nw-accent);
            border-radius: 999px;
            transition: width 0.6s ease;
        }

        .nw-label {
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.28em;
            text-transform: uppercase;
            color: rgba(15, 17, 21, 0.45);
            text-align: center;
            margin-top: 14px;
        }

        .nw-side {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .nw-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .nw-control {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            border: 1px solid var(--nw-line);
            background: var(--nw-surface-2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .nw-control:hover {
            transform: translateY(-1px);
            box-shadow: 0 0 0 2px rgba(122, 166, 255, 0.12);
        }

        .nw-control--primary {
            width: 84px;
            height: 84px;
            border-radius: 20px;
            background: var(--nw-accent);
            color: #ffffff;
            border: none;
            box-shadow: 0 12px 28px -20px rgba(122, 166, 255, 0.6);
        }

        .nw-control--primary:hover {
            box-shadow: 0 14px 30px -18px rgba(122, 166, 255, 0.7);
        }

        .nw-control--primary.is-playing {
            transform: scale(1.02);
        }

        .nw-stats {
            display: grid;
            gap: 8px;
            font-size: 13px;
            color: var(--nw-muted);
        }

        .nw-stat-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nw-stat-row strong {
            color: var(--nw-ink);
            font-weight: 600;
        }

        .nw-activity {
            margin-top: 24px;
            padding-top: 14px;
            border-top: 1px solid var(--nw-line);
        }

        .nw-quote {
            margin-top: 18px;
            padding-top: 14px;
            border-top: 1px solid var(--nw-line);
            font-size: 13px;
            color: var(--nw-muted);
            text-align: center;
            font-style: italic;
        }

        .nw-activity-label {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.3em;
            color: rgba(15, 17, 21, 0.45);
            margin-bottom: 10px;
        }

        .nw-activity-strip {
            display: flex;
            gap: 10px;
            align-items: center;
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .nw-preset-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .nw-preset {
            border: 1px solid var(--nw-line);
            background: var(--nw-surface-2);
            padding: 6px 10px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 600;
            color: var(--nw-muted);
            transition: all 0.2s ease;
        }

        .nw-preset.active {
            color: var(--nw-ink);
            border-color: rgba(255, 255, 255, 0.25);
        }

        .nw-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            border: 1px solid var(--nw-line);
            border-radius: 12px;
            padding: 8px 10px;
            font-size: 12px;
            color: var(--nw-muted);
            background: var(--nw-surface-2);
        }

        .nw-toggle button {
            width: 36px;
            height: 20px;
            border-radius: 999px;
            border: 1px solid var(--nw-line);
            background: rgba(255, 255, 255, 0.08);
            position: relative;
            transition: all 0.2s ease;
        }

        .nw-toggle button::after {
            content: "";
            position: absolute;
            top: 2px;
            left: 2px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #ffffff;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s ease;
        }

        .nw-toggle button.active {
            background: var(--nw-accent);
            border-color: transparent;
        }

        .nw-toggle button.active::after {
            transform: translateX(16px);
        }

        .nw-goal {
            display: grid;
            gap: 6px;
            font-size: 12px;
            color: var(--nw-muted);
        }

        .nw-goal-bar {
            height: 6px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.12);
            overflow: hidden;
        }

        .nw-goal-bar span {
            display: block;
            height: 100%;
            width: 0%;
            background: var(--nw-accent);
            transition: width 0.4s ease;
        }

        #taskChatPanel {
            grid-column: 1 / -1;
        }

        .nw-chat-display {
            max-height: 420px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .nw-input {
            width: 100%;
            border-radius: 999px;
            border: 1px solid var(--nw-line);
            padding: 16px 22px;
            background: var(--nw-surface-2);
            color: var(--nw-ink);
        }

        #neuralWorkspace .text-gray-500,
        #neuralWorkspace .text-gray-600,
        #neuralWorkspace .text-gray-700 {
            color: var(--nw-muted) !important;
        }

        #neuralWorkspace .text-gray-900 {
            color: var(--nw-ink) !important;
        }

        #neuralWorkspace .bg-white {
            background-color: var(--nw-surface-2) !important;
        }

        #neuralWorkspace .border-black\/5 {
            border-color: var(--nw-line) !important;
        }

        .nw-send {
            border-radius: 999px;
            padding: 14px 24px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.3em;
            text-transform: uppercase;
        }

        @media (max-width: 1024px) {
            .nw-focus-grid {
                grid-template-columns: 1fr;
            }

            .nw-timer-value {
                font-size: 54px;
            }

            .nw-progress {
                width: 200px;
            }
        }

        @media (max-width: 768px) {
            .nw-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .nw-panel-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .nw-shell {
                padding: 48px 18px 70px;
            }

            .nw-controls {
                flex-wrap: wrap;
            }
        }

        /* Atmospheric Mesh Gradient */
        .mesh-gradient-bg {
            position: absolute;
            inset: 0;
            overflow: hidden;
            background-color: #ffffff;
            z-index: 0;
        }

        .mesh-ball {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.4;
            mix-blend-mode: multiply;
            animation: mesh-float 25s infinite alternate ease-in-out;
        }

        @keyframes mesh-float {
            0% {
                transform: translate(0, 0) scale(1);
            }

            33% {
                transform: translate(10%, -10%) scale(1.2);
            }

            66% {
                transform: translate(-15%, 5%) scale(0.8);
            }

            100% {
                transform: translate(5%, 15%) scale(1.1);
            }
        }

        /* Editorial Typography */
        .text-editorial-light {
            font-weight: 300;
            letter-spacing: -0.02em;
        }

        .text-editorial-bold {
            font-weight: 800;
            letter-spacing: -0.04em;
        }

        /* Ultra Soft Depth */
        .shadow-soft-float {
            box-shadow:
                0 4px 6px -1px rgba(0, 0, 0, 0.05),
                0 10px 40px -10px rgba(0, 0, 0, 0.08),
                0 20px 60px -20px rgba(0, 0, 0, 0.1);
        }

        @keyframes floaty {
            0% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-8px);
            }

            100% {
                transform: translateY(0);
            }
        }

        .floaty {
            animation: floaty 6s ease-in-out infinite;
        }

        /* Glass Icon Polish */
        .glass-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px;
            background: rgba(255, 255, 255, 0.72);
            backdrop-filter: blur(18px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 12px 40px -18px rgba(0, 0, 0, 0.18);
            transition: transform 0.2s ease-out;
        }

        /* Search Shimmer */
        @keyframes shimmerEffect {
            0% {
                transform: translateX(-150%) skewX(-20deg);
            }

            100% {
                transform: translateX(250%) skewX(-20deg);
            }
        }

        .shimmer-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -50%;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transform: skewX(-20deg);
            pointer-events: none;
        }

        .shimmer-active::after {
            animation: shimmerEffect 2.5s ease-in-out infinite;
        }

        /* Micro-Shining Pills */
        .mode-pill {
            position: relative;
            overflow: hidden;
        }

        .mode-pill::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -60%;
            width: 20%;
            height: 200%;
            background: rgba(255, 255, 255, 0.4);
            transform: rotate(30deg);
            transition: all 0.5s ease;
            opacity: 0;
        }

        .mode-pill:hover::after {
            left: 140%;
            opacity: 1;
        }

        /* Glitch/Flash Transition */
        @keyframes flashIn {
            0% {
                filter: brightness(3);
                opacity: 0;
                transform: scale(0.98);
            }

            100% {
                filter: brightness(1);
                opacity: 1;
                transform: scale(1);
            }
        }

        .mode-flash {
            animation: flashIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Sentient Eyes Visual */
        .sentient-eyes {
            display: flex;
            gap: 4px;
            align-items: center;
            margin-right: 8px;
            transition: all 0.3s ease;
        }

        .sentient-eye {
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px var(--primary);
            animation: sentient-blink 4s infinite;
        }

        .group\/search:focus-within .sentient-eye {
            transform: scale(1.5);
            box-shadow: 0 0 15px var(--primary);
        }

        @keyframes sentient-blink {

            0%,
            90%,
            100% {
                transform: scaleY(1);
                opacity: 1;
            }

            95% {
                transform: scaleY(0.1);
                opacity: 0.5;
            }
        }

        .sentient-eyes.searching .sentient-eye {
            animation: sentient-alert 0.6s infinite alternate;
        }

        @keyframes sentient-alert {
            from {
                transform: scale(1.2);
                filter: brightness(1.2);
            }

            to {
                transform: scale(1.8);
                filter: brightness(1.5);
            }
        }

        :root {
            --primary: #ff4d6d;
            --ink: #0b0b0d;
            --muted: #f5f5f7;
            --line: #e7e7ea;
            --pastel-blue: #edf4ff;
            --pastel-pink: #fff1f4;
            --pastel-green: #edf7f0;
            --pastel-purple: #f3f0ff;
            --pastel-orange: #fff3e6;
            --pastel-cyan: #e9f6f8;
            --pastel-indigo: #eff1ff;
            --pastel-rose: #fff1f2;
            --pastel-yellow: #fff9e6;
            --dark: #0b0b0d;
            --light: #ffffff;
        }

        * {
            font-family: 'Nunito', sans-serif !important;
            letter-spacing: -0.003em;
        }

        body {
            font-size: 15.5px;
            line-height: 1.6;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
        }

        h1,
        h2,
        h3,
        h4,
        h5 {
            line-height: 1.15;
        }

        p {
            line-height: 1.7;
        }

        .font-display {
            font-family: 'Poppins', 'Nunito', sans-serif !important;
            letter-spacing: -0.01em;
        }

        .logo-daisy {
            font-family: 'Poppins', 'Nunito', sans-serif !important;
            font-weight: 600;
            letter-spacing: -0.03em;
            text-transform: lowercase;
            color: var(--ink);
        }

        .logo-mark {
            width: 36px;
            height: 36px;
            border-radius: 12px;
            background: radial-gradient(circle at 30% 30%, #ffffff 0%, #f2f2f4 45%, #e6e6ea 100%);
            border: 1px solid rgba(15, 15, 18, 0.06);
            box-shadow: 0 10px 30px -18px rgba(0, 0, 0, 0.35);
        }

        .logo-mark svg {
            width: 20px;
            height: 20px;
        }

        /* Mascot-Symbol Hybrid Daisy SVG Styles */
        .daisy-icon {
            filter: none;
        }

        .daisy-center {
            fill: #FFD23F;
            /* Vibrant Warm Yellow */
        }

        .daisy-petal {
            fill: var(--ink);
            /* Bold Silhouette */
        }

        .daisy-mascot-eye {
            fill: var(--ink);
        }

        .daisy-mascot-smile {
            fill: none;
            stroke: var(--ink);
            stroke-width: 1.2;
            stroke-linecap: round;
        }

        /* Clean Background */
        .bg-daisy-white {
            background: #f7f7f9;
        }

        /* Haptic Pop Effect */
        .haptic-pop {
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .haptic-pop:active {
            transform: scale(0.92);
        }

        /* Voice Pulse Animation */
        @keyframes voice-pulse {
            0% {
                height: 4px;
            }

            50% {
                height: 16px;
            }

            100% {
                height: 4px;
            }
        }

        .voice-bar {
            width: 3px;
            background: var(--primary);
            border-radius: 99px;
            animation: voice-pulse 0.8s ease-in-out infinite;
        }

        /* Memory Vault Shimmer */
        .memory-card {
            position: relative;
            overflow: hidden;
        }

        .memory-card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transform: rotate(45deg);
            transition: 0.5s;
            opacity: 0;
        }

        .memory-card:hover::after {
            left: 100%;
            opacity: 1;
        }

        .phone-frame {
            border: 12px solid #1a1a1a;
            border-radius: 3rem;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
            box-shadow: 0 50px 100px -20px rgba(0, 0, 0, 0.25), 0 30px 60px -30px rgba(0, 0, 0, 0.3);
        }

        /* DNA Bar Pulsing */
        @keyframes pulse-dna {
            0% {
                opacity: 0.4;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.4;
            }
        }

        .animate-pulse-dna {
            animation: pulse-dna 2s ease-in-out infinite;
        }

        /* Scroll Reveal Hidden State */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .glass-strong {
            background: rgba(255, 255, 255, 0.94);
            backdrop-filter: blur(14px);
            border-bottom: 1px solid rgba(15, 15, 18, 0.08);
        }

        .text-gradient {
            background: linear-gradient(135deg, #111827 0%, #6b7280 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card-hover:hover {
            transform: translateY(-6px);
            box-shadow: 0 18px 36px -16px rgba(15, 15, 18, 0.22);
        }

        .bg-ambient {
            background: radial-gradient(1200px 500px at 10% -10%, #ffffff 10%, transparent 60%),
                radial-gradient(900px 500px at 90% 10%, #f6f6f8 0%, transparent 55%),
                radial-gradient(800px 500px at 50% 100%, #f2f2f6 0%, transparent 50%),
                #f7f7f9;
        }

        .noise {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
            mix-blend-mode: multiply;
            opacity: 0.35;
        }

        .theme-pastel {
            --primary: #ff8ab3;
            --accent: #1b1b1f;
            --muted: #f7f1f4;
            --line: #eadde4;
        }

        .theme-pastel .bg-ambient {
            background: radial-gradient(1200px 500px at 10% -10%, #fff6fb 10%, transparent 60%),
                radial-gradient(900px 500px at 90% 10%, #f7f0ff 0%, transparent 55%),
                radial-gradient(800px 500px at 50% 100%, #f2f7ff 0%, transparent 50%),
                #faf7fb;
        }

        @keyframes toastIn {
            from {
                transform: translateY(10px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .toast-enter {
            animation: toastIn 0.35s ease-out;
        }

        .progress-gradient {
            background: linear-gradient(90deg, #111827 0%, #6b7280 100%);
        }

        /* reward bar removed */

        .theme-switcher {
            position: fixed;
            right: 18px;
            bottom: 18px;
            z-index: 120;
        }

        .theme-panel {
            display: none;
            margin-bottom: 8px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.7);
            border-radius: 16px;
            backdrop-filter: blur(12px);
            box-shadow: 0 16px 40px -24px rgba(0, 0, 0, 0.25);
        }

        .theme-panel.active {
            display: flex;
            gap: 8px;
        }

        .theme-dot {
            width: 22px;
            height: 22px;
            border-radius: 999px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            cursor: pointer;
        }

        body[data-bg="sand"] {
            background: radial-gradient(1200px 500px at 10% -10%, #fff7ec 10%, transparent 60%),
                radial-gradient(900px 500px at 90% 10%, #f5efe6 0%, transparent 55%),
                radial-gradient(800px 500px at 50% 100%, #f3ede3 0%, transparent 50%),
                #faf5ec;
        }

        body[data-bg="slate"] {
            background: radial-gradient(1200px 500px at 10% -10%, #f3f4f6 10%, transparent 60%),
                radial-gradient(900px 500px at 90% 10%, #e5e7eb 0%, transparent 55%),
                radial-gradient(800px 500px at 50% 100%, #f9fafb 0%, transparent 50%),
                #f3f4f6;
        }

        body[data-bg="olive"] {
            background: radial-gradient(1200px 500px at 10% -10%, #f6f7f0 10%, transparent 60%),
                radial-gradient(900px 500px at 90% 10%, #eef0e6 0%, transparent 55%),
                radial-gradient(800px 500px at 50% 100%, #f7f8f2 0%, transparent 50%),
                #f4f6ee;
        }

        body[data-bg="stone"] {
            background: radial-gradient(1200px 500px at 10% -10%, #f8f8f8 10%, transparent 60%),
                radial-gradient(900px 500px at 90% 10%, #f0f0f0 0%, transparent 55%),
                radial-gradient(800px 500px at 50% 100%, #f7f7f7 0%, transparent 50%),
                #f6f6f6;
        }

        body[data-bg="default"] {
            background: radial-gradient(1200px 500px at 10% -10%, #ffffff 10%, transparent 60%),
                radial-gradient(900px 500px at 90% 10%, #f6f6f8 0%, transparent 55%),
                radial-gradient(800px 500px at 50% 100%, #f2f2f6 0%, transparent 50%),
                #f7f7f9;
        }

        .anime-widget {
            position: fixed;
            top: 18%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 130;
            padding: 16px 22px;
            border-radius: 20px;
            background: linear-gradient(135deg, #ffe7f4 0%, #eaf1ff 100%);
            box-shadow: 0 20px 50px -30px rgba(0, 0, 0, 0.35);
            border: 1px solid rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: popIn 0.5s ease-out, floatUpWidget 1.6s ease-in-out forwards;
        }

        .anime-badge {
            width: 42px;
            height: 42px;
            border-radius: 14px;
            background: radial-gradient(circle at 30% 30%, #fff8d1 0%, #ffd35c 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        @keyframes popIn {
            from {
                transform: translate(-50%, 10px) scale(0.95);
                opacity: 0;
            }

            to {
                transform: translate(-50%, 0) scale(1);
                opacity: 1;
            }
        }

        @keyframes floatUpWidget {
            to {
                transform: translate(-50%, -30px);
                opacity: 0;
            }
        }

        .glow-hover:hover {
            box-shadow: 0 12px 30px -18px rgba(255, 123, 190, 0.6);
            transform: translateY(-1px);
        }

        .glow-enabled .glow-hover:hover {
            box-shadow: 0 18px 40px -18px rgba(255, 123, 190, 0.85);
        }

        .avatar-enabled .avatar-stack img {
            box-shadow: 0 0 0 2px rgba(255, 123, 190, 0.6);
        }

        .coin-float {
            position: absolute;
            animation: floatUp 1.2s ease-out forwards;
            font-weight: 700;
            color: #ff7bbe;
            text-shadow: 0 6px 20px rgba(255, 123, 190, 0.5);
        }

        .sparkle {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 999px;
            background: #ffd35c;
            animation: sparkle 0.9s ease-out forwards;
        }

        @keyframes floatUp {
            from {
                transform: translateY(0);
                opacity: 1;
            }

            to {
                transform: translateY(-60px);
                opacity: 0;
            }
        }

        @keyframes sparkle {
            from {
                transform: scale(1) translate(0, 0);
                opacity: 1;
            }

            to {
                transform: scale(0) translate(20px, -20px);
                opacity: 0;
            }
        }

        .ring-track {
            stroke: rgba(0, 0, 0, 0.08);
        }

        .ring-progress {
            stroke: url(#ringGrad);
        }

        .shimmer-bg {
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            background-size: 200% 100%;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* === DOPAMINE REWARDS SYSTEM === */

        /* Floating Coin Animation */
        @keyframes coinFloat {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }

            100% {
                transform: translateY(-80px) scale(0.5);
                opacity: 0;
            }
        }

        .coin-float-anim {
            animation: coinFloat 1.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            pointer-events: none;
            position: fixed;
            z-index: 9999;
            font-weight: 800;
            font-size: 18px;
            color: #FFD700;
            text-shadow: 0 2px 8px rgba(255, 215, 0, 0.5);
        }

        /* Confetti Burst */
        @keyframes confettiFall {
            0% {
                transform: translateY(-20px) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            z-index: 9998;
            pointer-events: none;
            animation: confettiFall 3s ease-out forwards;
        }

        /* Streak Fire Glow */
        @keyframes fireGlow {

            0%,
            100% {
                filter: drop-shadow(0 0 4px #FF6B35) drop-shadow(0 0 8px #FF4500);
            }

            50% {
                filter: drop-shadow(0 0 8px #FF6B35) drop-shadow(0 0 16px #FF4500);
            }
        }

        .streak-fire {
            animation: fireGlow 1.5s ease-in-out infinite;
        }

        .streak-fire.at-risk {
            animation: fireGlow 0.5s ease-in-out infinite;
        }

        /* Level Ring Progress */
        .level-ring {
            transform: rotate(-90deg);
        }

        .level-ring-progress {
            stroke-dasharray: 100;
            stroke-dashoffset: 100;
            transition: stroke-dashoffset 1s ease-out;
        }

        /* Rewards Pill Hover */
        .rewards-pill {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .rewards-pill:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px -8px rgba(0, 0, 0, 0.15);
        }

        /* Daily Bonus Shine */
        @keyframes shine {
            0% {
                transform: translateX(-100%) rotate(45deg);
            }

            100% {
                transform: translateX(200%) rotate(45deg);
            }
        }

        .bonus-shine::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shine 2s ease-in-out infinite;
        }

        /* Level Up Celebration */
        @keyframes levelUpPulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .level-up-celebrate {
            animation: levelUpPulse 0.6s ease-in-out;
        }

        /* Shop Item Hover */
        .shop-item {
            transition: all 0.3s ease;
        }

        .shop-item:hover:not(.locked) {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px -12px rgba(0, 0, 0, 0.2);
        }

        .shop-item.locked {
            opacity: 0.6;
            filter: grayscale(0.3);
        }

        /* Counter Animation */
        @keyframes countUp {
            0% {
                transform: scale(1.3);
                color: #FFD700;
            }

            100% {
                transform: scale(1);
                color: inherit;
            }
        }

        .count-animate {
            animation: countUp 0.4s ease-out;
        }

        /* Floating Arrow Animation */
        @keyframes floatArrow {

            0%,
            100% {
                transform: translateX(0) translateY(0);
                opacity: 0.4;
            }

            50% {
                transform: translateX(8px) translateY(-2px);
                opacity: 1;
            }
        }

        .float-arrow {
            animation: floatArrow 1.5s ease-in-out infinite;
        }

        .float-arrow:nth-child(2) {
            animation-delay: 0.2s;
        }

        .float-arrow:nth-child(3) {
            animation-delay: 0.4s;
        }

        /* === FOCUS TIMER - AESTHETIC THEMED DESIGN === */
        /* === FOCUS TIMER - PREMIUM MINIMAL DESIGN === */
        .pomo-container {
            --pomo-bg: #ffffff;
            --pomo-surface: rgba(0, 0, 0, 0.02);
            --pomo-border: rgba(0, 0, 0, 0.05);
            --pomo-ink: #1d1d1f;
            --pomo-muted: rgba(29, 29, 31, 0.5);
            --pomo-accent: #0071e3;
            --pomo-glass: rgba(0, 0, 0, 0.04);
            --pomo-glass-border: rgba(0, 0, 0, 0.08);

            min-height: 100vh;
            height: 100vh;
            margin: 0 !important;
            padding: 0 !important;
            overflow: hidden !important;
            position: relative;
            z-index: 100 !important;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', sans-serif;
            background: var(--pomo-bg) !important;
            color: var(--pomo-ink) !important;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .pomo-container.dark-mode {
            --pomo-bg: #0a0a0b;
            --pomo-surface: rgba(255, 255, 255, 0.03);
            --pomo-border: rgba(255, 255, 255, 0.08);
            --pomo-ink: #f5f5f7;
            --pomo-muted: rgba(245, 245, 247, 0.4);
            --pomo-accent: #0a84ff;
            --pomo-glass: rgba(255, 255, 255, 0.04);
            --pomo-glass-border: rgba(255, 255, 255, 0.15);
        }

        .pomo-container.ice-mode {
            --pomo-bg: #D6EFFF;
            --pomo-surface: rgba(29, 58, 90, 0.04);
            --pomo-border: rgba(29, 58, 90, 0.08);
            --pomo-ink: #1d3a5a;
            --pomo-muted: rgba(29, 58, 90, 0.5);
            --pomo-accent: #0071e3;
            --pomo-glass: rgba(255, 255, 255, 0.4);
            --pomo-glass-border: rgba(255, 255, 255, 0.6);
            --orb-1: #93c5fd;
            --orb-2: #bfdbfe;
        }

        .pomo-container.sunset-mode {
            --pomo-bg: #FFD3B6;
            --pomo-surface: rgba(128, 50, 0, 0.03);
            --pomo-border: rgba(128, 50, 0, 0.08);
            --pomo-ink: #4a1d1d;
            --pomo-muted: rgba(74, 29, 29, 0.5);
            --pomo-accent: #ff6b6b;
            --pomo-glass: rgba(255, 255, 255, 0.3);
            --pomo-glass-border: rgba(255, 255, 255, 0.5);
            --orb-1: #ffa8a8;
            --orb-2: #ffc9c9;
        }

        .pomo-container.forest-mode {
            --pomo-bg: #1B2721;
            --pomo-surface: rgba(255, 255, 255, 0.02);
            --pomo-border: rgba(255, 255, 255, 0.08);
            --pomo-ink: #d4e3d9;
            --pomo-muted: rgba(212, 227, 217, 0.4);
            --pomo-accent: #40c463;
            --pomo-glass: rgba(255, 255, 255, 0.04);
            --pomo-glass-border: rgba(255, 255, 255, 0.12);
            --orb-1: #2d4f3b;
            --orb-2: #1b2721;
        }

        .pomo-container.cyber-mode {
            --pomo-bg: #0d1117;
            --pomo-surface: rgba(0, 242, 255, 0.03);
            --pomo-border: rgba(0, 242, 255, 0.15);
            --pomo-ink: #c9d1d9;
            --pomo-muted: rgba(201, 209, 217, 0.4);
            --pomo-accent: #00f2ff;
            --pomo-glass: rgba(0, 242, 255, 0.05);
            --pomo-glass-border: rgba(0, 242, 255, 0.2);
            --orb-1: #004d40;
            --orb-2: #0d1117;
        }

        .pomo-container.lavender-mode {
            --pomo-bg: #E6E6FA;
            --pomo-surface: rgba(80, 50, 120, 0.04);
            --pomo-border: rgba(80, 50, 120, 0.1);
            --pomo-ink: #2a1f3d;
            --pomo-muted: rgba(42, 31, 61, 0.5);
            --pomo-accent: #9370db;
            --pomo-glass: rgba(255, 255, 255, 0.5);
            --pomo-glass-border: rgba(255, 255, 255, 0.7);
            --orb-1: #d8b4fe;
            --orb-2: #e9d5ff;
        }

        .pomo-container.nordic-mode {
            --pomo-bg: #F5F5DC;
            --pomo-surface: rgba(139, 69, 19, 0.03);
            --pomo-border: rgba(139, 69, 19, 0.1);
            --pomo-ink: #3d2b1f;
            --pomo-muted: rgba(61, 43, 31, 0.5);
            --pomo-accent: #8b4513;
            --pomo-glass: rgba(255, 255, 255, 0.4);
            --pomo-glass-border: rgba(255, 255, 255, 0.6);
            --orb-1: #d2b48c;
            --orb-2: #f5f5dc;
        }

        .pomo-container.arctic-mode {
            --pomo-bg: #E0FFFF;
            --pomo-surface: rgba(0, 255, 255, 0.04);
            --pomo-border: rgba(0, 255, 255, 0.15);
            --pomo-ink: #1a3a3a;
            --pomo-muted: rgba(26, 58, 58, 0.6);
            --pomo-accent: #008b8b;
            --pomo-glass: rgba(255, 255, 255, 0.5);
            --pomo-glass-border: rgba(255, 255, 255, 0.8);
            --orb-1: #afeeee;
            --orb-2: #00ffff;
        }

        .pomo-container.luxury-mode {
            --pomo-bg: #F7E7CE;
            --pomo-surface: rgba(225, 193, 110, 0.05);
            --pomo-border: rgba(225, 193, 110, 0.2);
            --pomo-ink: #4a3721;
            --pomo-muted: rgba(74, 55, 33, 0.5);
            --pomo-accent: #d4af37;
            --pomo-glass: rgba(255, 255, 255, 0.6);
            --pomo-glass-border: rgba(255, 255, 255, 0.8);
            --orb-1: #e1c16e;
            --orb-2: #f7e7ce;
        }

        .pomo-container.matrix-mode {
            --pomo-bg: #0a1a0a;
            --pomo-surface: rgba(0, 255, 0, 0.02);
            --pomo-border: rgba(0, 255, 0, 0.1);
            --pomo-ink: #2dfa2d;
            --pomo-muted: rgba(45, 250, 45, 0.4);
            --pomo-accent: #00ff00;
            --pomo-glass: rgba(0, 20, 0, 0.8);
            --pomo-glass-border: rgba(0, 255, 0, 0.2);
            --orb-1: #003300;
            --orb-2: #0a1a0a;
        }

        .pomo-container.rose-mode {
            --pomo-bg: #FFE4E1;
            --pomo-surface: rgba(255, 182, 193, 0.05);
            --pomo-border: rgba(255, 182, 193, 0.15);
            --pomo-ink: #4d2b2b;
            --pomo-muted: rgba(77, 43, 43, 0.5);
            --pomo-accent: #ff69b4;
            --pomo-glass: rgba(255, 255, 255, 0.5);
            --pomo-glass-border: rgba(255, 255, 255, 0.7);
            --orb-1: #ffb6c1;
            --orb-2: #ffe4e1;
        }

        .pomo-container.stealth-mode {
            --pomo-bg: #000000;
            --pomo-surface: rgba(255, 255, 255, 0.01);
            --pomo-border: rgba(255, 255, 255, 0.05);
            --pomo-ink: #e0e0e0;
            --pomo-muted: rgba(224, 224, 224, 0.3);
            --pomo-accent: #ffffff;
            --pomo-glass: rgba(0, 0, 0, 0.9);
            --pomo-glass-border: rgba(255, 255, 255, 0.1);
            --orb-1: #0a0a0a;
            --orb-2: #000000;
        }

        /* Glass Spotlight Effect */
        .pomo-spotlight {
            position: absolute;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0) 75%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
            mix-blend-mode: overlay;
            transform: translate(-50%, -50%);
            transition: opacity 0.6s ease;
            opacity: 0;
            left: -1000px;
            /* Hidden initially */
            top: -1000px;
        }

        .pomo-container:hover .pomo-spotlight {
            opacity: 1;
        }

        /* === LIQUID CORE PROGRESS === */
        .pomo-liquid-container {
            position: absolute;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
            z-index: 0;
            border-radius: 32px;
            opacity: 0.15;
            transition: opacity 0.6s ease;
        }

        .pomo-container.timer-active .pomo-liquid-container {
            opacity: 0.25;
        }

        .pomo-liquid-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%;
            /* Dynamic */
            background: var(--pomo-accent);
            transition: height 1s ease-in-out;
        }

        .pomo-wave {
            position: absolute;
            top: -20px;
            left: 0;
            width: 200%;
            height: 40px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120' preserveAspectRatio='none'%3E%3Cpath d='M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z' fill='%23ffffff'/%3E%3C/svg%3E");
            background-size: 50% 100%;
            animation: waveFlow 4s linear infinite;
            filter: opacity(0.3);
            transform: scaleY(-1);
            /* Flip wave to be at top of fill */
        }

        @keyframes waveFlow {
            0% {
                transform: translateX(0) scaleY(-1);
            }

            100% {
                transform: translateX(-50%) scaleY(-1);
            }
        }

        /* === VICTORY GLOW === */
        .victory-aura {
            position: absolute;
            inset: -100px;
            background: radial-gradient(circle, var(--pomo-accent) 0%, transparent 70%);
            opacity: 0;
            pointer-events: none;
            z-index: 10;
            transition: all 1s ease-out;
            border-radius: 50%;
        }

        .victory-aura.animate {
            animation: victoryPulse 2s ease-out forwards;
        }

        @keyframes victoryPulse {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }

            50% {
                transform: scale(1.2);
                opacity: 0.4;
            }

            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }

        /* Update original themes with orbs */
        .pomo-container {
            --orb-1: #f3f4f6;
            --orb-2: #e5e7eb;
            /* ... rest same ... */
        }

        .pomo-container.dark-mode {
            --orb-1: #1f2937;
            --orb-2: #111827;
        }

        /* Theme Backgrounds - Removed */

        .pomo-shell {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 0;
            width: 100vw;
            height: 100vh;
            min-height: 100vh;
            overflow: hidden;
        }

        /* Zen Mode Transitions (Focus Fade) */
        .pomo-header,
        .pomo-sidebar,
        .pomo-stats-row,
        .pomo-mode-tabs {
            transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1), transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .pomo-container.pomo-running .pomo-header,
        .pomo-container.pomo-running .pomo-sidebar,
        .pomo-container.pomo-running .pomo-stats-row,
        .pomo-container.pomo-running .pomo-mode-tabs {
            opacity: 0.1;
            pointer-events: none;
        }

        .pomo-container.pomo-running .pomo-shell:hover .pomo-header,
        .pomo-container.pomo-running .pomo-shell:hover .pomo-sidebar,
        .pomo-container.pomo-running .pomo-shell:hover .pomo-stats-row,
        .pomo-container.pomo-running .pomo-shell:hover .pomo-mode-tabs {
            opacity: 1;
            pointer-events: auto;
        }

        /* Left Panel - Timer */
        .pomo-main {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 48px;
            position: relative;
        }

        .pomo-header {
            position: absolute;
            top: 40px;
            left: 40px;
            right: 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .pomo-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .pomo-back-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--pomo-ink);
            opacity: 0.5;
        }

        .pomo-back-btn:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-4px);
        }

        .pomo-title {
            font-size: 12px;
            font-weight: 800;
            color: var(--pomo-ink);
            letter-spacing: 0.2em;
            text-transform: uppercase;
            opacity: 0.4;
        }

        /* Theme Toggle Button */
        .pomo-theme-toggle {
            margin-left: 16px;
            width: 32px;
            height: 32px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--pomo-muted);
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--pomo-surface);
            border: 0.5px solid var(--pomo-border);
        }

        .pomo-theme-toggle:hover {
            color: var(--pomo-ink);
            background: rgba(0, 0, 0, 0.05);
            transform: translateY(-1px);
        }

        .pomo-container.dark-mode .pomo-theme-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .pomo-theme-toggle svg {
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .pomo-theme-toggle:active svg {
            transform: scale(0.8) rotate(-45deg);
        }

        .pomo-timer-wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 64px;
        }

        /* Minimal Mode Switcher (Dot Indicator) */
        .pomo-mode-tabs {
            display: flex;
            gap: 40px;
        }

        .pomo-mode-tab {
            font-size: 14px;
            font-weight: 600;
            color: var(--pomo-muted);
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            background: transparent;
            position: relative;
            padding-bottom: 8px;
        }

        .pomo-mode-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 4px;
            height: 4px;
            background: var(--pomo-ink);
            border-radius: 50%;
            transform: translateX(-50%) scale(0);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .pomo-mode-tab.active {
            color: var(--pomo-ink);
        }

        .pomo-mode-tab.active::after {
            transform: translateX(-50%) scale(1);
        }

        /* Big Timer Display - Micro-Pulse "Breath" */
        @keyframes timerBreath {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
                filter: blur(0);
            }

            50% {
                transform: scale(1.015);
                opacity: 0.9;
                filter: blur(0.5px);
            }
        }

        .pomo-time-container {
            text-align: center;
        }

        .pomo-time {
            font-size: 160px;
            font-weight: 200;
            letter-spacing: -0.05em;
            color: var(--pomo-ink);
            font-variant-numeric: tabular-nums;
            line-height: 0.9;
            animation: timerBreath 8s ease-in-out infinite;
        }

        .pomo-session-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--pomo-muted);
            margin-top: 16px;
            text-transform: uppercase;
            letter-spacing: 0.4em;
            opacity: 0.5;
        }

        /* Ghost Controls */
        .pomo-controls {
            display: flex;
            align-items: center;
            gap: 48px;
        }

        .pomo-btn {
            border: none;
            background: transparent;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--pomo-ink);
            opacity: 0.3;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pomo-btn:hover {
            opacity: 1;
            transform: scale(1.15);
        }

        .pomo-btn-primary {
            width: 88px;
            height: 88px;
            border: 1px solid var(--pomo-glass-border);
            border-radius: 50%;
            background: var(--pomo-glass);
            backdrop-filter: blur(10px);
        }

        .pomo-btn-primary:hover {
            background: var(--pomo-glass-border);
            border-color: var(--pomo-ink);
        }

        /* Stats Row */
        .pomo-stats-row {
            display: flex;
            gap: 64px;
            margin-top: 24px;
        }

        .pomo-stat-value {
            font-size: 24px;
            font-weight: 200;
            color: var(--pomo-ink);
        }

        .pomo-stat-label {
            font-size: 9px;
            font-weight: 800;
            color: var(--pomo-muted);
            text-transform: uppercase;
            letter-spacing: 0.15em;
            margin-top: 6px;
            opacity: 0.6;
        }

        /* Right Panel - Deep Glassmorphism */
        .pomo-sidebar {
            background: var(--pomo-surface);
            backdrop-filter: blur(40px);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            border-left: 0.5px solid var(--pomo-border);
        }

        .pomo-sidebar-header {
            padding: 48px 40px 24px;
        }

        .pomo-sidebar-title {
            font-size: 22px;
            font-weight: 300;
            letter-spacing: -0.02em;
            color: var(--pomo-ink);
        }

        .pomo-sidebar-subtitle {
            font-size: 11px;
            opacity: 0.4;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: 4px;
            font-weight: 800;
            color: var(--pomo-ink);
        }

        .pomo-zen-label {
            font-size: 9px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* === COMPOSER PORTALS (Music Player) === */
        .pomo-composer-section {
            padding: 24px 40px;
            border-top: 0.5px solid var(--pomo-border);
        }

        .pomo-music-player {
            background: var(--pomo-glass);
            border: 1px solid var(--pomo-glass-border);
            border-radius: 20px;
            padding: 16px;
            margin-top: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .pomo-player-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .pomo-player-icon {
            width: 32px;
            height: 32px;
            background: var(--pomo-accent);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 4px 12px -4px var(--pomo-accent);
        }

        .pomo-player-text {
            flex: 1;
        }

        .pomo-track-name {
            font-size: 13px;
            font-weight: 700;
            color: var(--pomo-ink);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .pomo-artist-name {
            font-size: 10px;
            font-weight: 600;
            color: var(--pomo-ink);
            opacity: 0.5;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .pomo-player-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .pomo-nav-btn {
            width: 28px;
            height: 28px;
            background: var(--pomo-glass);
            border: 1px solid var(--pomo-glass-border);
            color: var(--pomo-ink);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.6;
        }

        .pomo-nav-btn:hover {
            opacity: 1;
            background: var(--pomo-surface);
            transform: scale(1.1);
        }

        .pomo-play-pause-btn {
            width: 36px;
            height: 36px;
            background: var(--pomo-ink);
            color: var(--pomo-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .pomo-play-pause-btn:hover {
            transform: scale(1.1);
        }

        .pomo-progress-wrap {
            flex: 1;
            height: 4px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 2px;
            position: relative;
            cursor: pointer;
            margin: 0 4px;
        }

        .pomo-progress-bar {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: var(--pomo-accent);
            border-radius: 2px;
            width: 0%;
            transition: width 0.1s linear;
        }

        .pomo-player-time {
            font-size: 9px;
            font-weight: 800;
            color: var(--pomo-ink);
            opacity: 0.4;
            min-width: 30px;
            text-align: right;
        }

        /* === FOCUS JOURNALING (Timeline) === */
        .pomo-timeline-section {
            padding: 32px 40px;
            border-top: 0.5px solid var(--pomo-border);
            flex: 1;
            overflow-y: auto;
        }

        .pomo-timeline {
            position: relative;
            margin-top: 24px;
            padding-left: 20px;
        }

        .pomo-timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 5px;
            bottom: 5px;
            width: 1px;
            background: var(--pomo-border);
        }

        .pomo-log-item {
            position: relative;
            margin-bottom: 24px;
        }

        .pomo-log-dot {
            position: absolute;
            left: -23.5px;
            top: 5px;
            width: 8px;
            height: 8px;
            background: var(--pomo-bg);
            border: 2px solid var(--pomo-accent);
            border-radius: 50%;
            z-index: 1;
        }

        .pomo-log-time {
            font-size: 10px;
            font-weight: 800;
            color: var(--pomo-accent);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            opacity: 0.8;
        }

        .pomo-log-meta {
            font-size: 11px;
            font-weight: 600;
            color: var(--pomo-ink);
            margin-top: 2px;
        }

        .pomo-log-text {
            font-size: 13px;
            line-height: 1.5;
            color: var(--pomo-ink);
            opacity: 0.7;
            margin-top: 6px;
            font-style: italic;
        }

        .pomo-log-text:empty {
            display: none;
        }

        /* Contribution Section */
        .pomo-contrib-section {
            padding: 24px 40px;
            border-top: 0.5px solid var(--pomo-border);
        }

        .pomo-contrib-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .pomo-contrib-title {
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            opacity: 0.5;
            color: var(--pomo-ink);
        }

        .pomo-contrib-count {
            font-size: 11px;
            font-weight: 800;
            color: #40c463;
        }

        .pomo-squares-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .pomo-square {
            aspect-ratio: 1/1;
            border-radius: 3px;
            background: rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }

        .pomo-square:hover {
            transform: scale(1.15);
            z-index: 10;
        }

        .pomo-square.level-1 {
            background: #9be9a8;
        }

        .pomo-square.level-2 {
            background: #40c463;
        }

        .pomo-square.level-3 {
            background: #30a14e;
        }

        .pomo-square.level-4 {
            background: #216e39;
        }

        .pomo-square.today {
            box-shadow: 0 0 0 2px var(--pomo-ink);
        }

        .pomo-legend {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 4px;
            margin-top: 16px;
            font-size: 10px;
            color: var(--pomo-muted);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .pomo-legend-square {
            width: 10px;
            height: 10px;
            border-radius: 2px;
        }

        /* Today's Stats Card - Simplified */
        .pomo-today-card {
            margin: 24px 40px;
            padding: 24px;
            background: var(--pomo-surface);
            border: 0.5px solid var(--pomo-border);
            border-radius: 24px;
        }

        .pomo-today-row {
            display: flex;
            justify-content: space-around;
        }

        .pomo-today-value {
            font-size: 28px;
            font-weight: 200;
            color: var(--pomo-ink);
        }

        .pomo-today-label {
            font-size: 9px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            opacity: 0.5;
            color: var(--pomo-ink);
            margin-top: 4px;
        }

        /* Notes Section */
        .pomo-notes-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 24px 40px;
            border-top: 0.5px solid var(--pomo-border);
        }

        .pomo-notes-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .pomo-notes-title {
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            opacity: 0.5;
            color: var(--pomo-ink);
        }

        .pomo-notes-clear {
            font-size: 11px;
            font-weight: 800;
            color: var(--pomo-accent);
            background: none;
            border: none;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .pomo-notes-textarea {
            flex: 1;
            background: transparent;
            border: none;
            resize: none;
            font-size: 15px;
            line-height: 1.7;
            color: var(--pomo-ink);
            outline: none;
            opacity: 0.7;
        }

        .pomo-notes-textarea::placeholder {
            color: var(--pomo-muted);
            opacity: 0.4;
        }

        /* Quick Actions */
        .pomo-quick-actions {
            display: flex;
            padding: 24px 40px 48px;
            gap: 12px;
        }

        .pomo-quick-btn {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            background: var(--pomo-surface);
            border: 0.5px solid var(--pomo-border);
            color: var(--pomo-ink);
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pomo-quick-btn.active {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            color: #1d1d1f !important;
            /* Pure dark text as requested */
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .pomo-container.dark-mode .pomo-quick-btn.active {
            background: rgba(255, 255, 255, 0.85);
            color: #000000 !important;
            /* Pure black text in dark mode */
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        /* Responsive */
        /* Responsive */
        @media (max-width: 1024px) {
            .pomo-shell {
                grid-template-columns: 1fr;
            }

            .pomo-sidebar {
                border-left: none;
                border-top: 0.5px solid rgba(255, 255, 255, 0.1);
            }

            .pomo-header {
                top: 24px;
                left: 24px;
                right: 24px;
            }

            .pomo-main {
                padding-top: 100px;
            }
        }

        @media (max-width: 640px) {
            .pomo-time {
                font-size: 110px;
            }

            .pomo-stats-row {
                gap: 40px;
            }
        }
    </style>
</head>

<body
    class="bg-ambient text-gray-900 font-sans antialiased selection:bg-primary selection:text-white overflow-x-hidden">

    <!-- Reward Bar removed: replaced by inline hero badges -->

    <!-- Atmospheric Background -->
    <div class="fixed inset-0 pointer-events-none z-0 mesh-gradient-bg">
        <div class="mesh-ball w-[800px] h-[800px] bg-pastel-blue top-[-10%] left-[-10%]" style="animation-delay: 0s;">
        </div>
        <div class="mesh-ball w-[700px] h-[700px] bg-pastel-pink bottom-[10%] right-[-5%]"
            style="animation-delay: -5s;"></div>
        <div class="mesh-ball w-[600px] h-[600px] bg-pastel-purple top-[30%] left-[20%] opacity-20"
            style="animation-delay: -10s;"></div>
        <div class="mesh-ball w-[650px] h-[650px] bg-pastel-indigo bottom-[-5%] left-[5%] opacity-30"
            style="animation-delay: -15s;"></div>
        <div class="absolute inset-0 noise opacity-[0.03]"></div>
    </div>

    <!-- Promo Banner -->
    <div class="bg-accent py-2 text-center relative z-50">
        <p class="text-[10px] font-medium uppercase tracking-[0.3em] text-white/90">Experience the Future of Personal
            Intelligence  Beta Access Open</p>
    </div>

    <!-- Navigation -->
    <nav class="fixed w-full z-50 transition-all duration-500 border-b border-transparent" id="navbar">
        <!-- Intelligence Tracker Bar (Sentient UI) -->
        <div class="h-1 w-full bg-primary/10 relative overflow-hidden">
            <div id="dnaBar" class="absolute top-0 left-0 h-full bg-primary transition-all duration-1000 ease-out"
                style="width: 82%;"></div>
            <div
                class="absolute top-0 left-0 h-full w-full bg-gradient-to-r from-transparent via-white/40 to-transparent animate-pulse-dna">
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="flex justify-between items-center h-20 transition-all duration-500" id="navContainer">
                <div class="flex items-center gap-2.5 group cursor-pointer"
                    onclick="window.scrollTo({top:0, behavior:'smooth'})">
                    <div
                        class="logo-mark flex items-center justify-center group-hover:scale-105 transition-transform duration-500">
                        <svg viewBox="0 0 32 32" fill="none" aria-hidden="true">
                            <circle cx="16" cy="16" r="6.5" fill="#0b0b0d" />
                            <g fill="#0b0b0d" opacity="0.22">
                                <circle cx="16" cy="2.5" r="2" />
                                <circle cx="16" cy="29.5" r="2" />
                                <circle cx="2.5" cy="16" r="2" />
                                <circle cx="29.5" cy="16" r="2" />
                                <circle cx="7" cy="7" r="1.8" />
                                <circle cx="25" cy="7" r="1.8" />
                                <circle cx="7" cy="25" r="1.8" />
                                <circle cx="25" cy="25" r="1.8" />
                            </g>
                        </svg>
                    </div>
                    <span class="logo-daisy text-[22px]">daisy</span>
                </div>

                <div class="hidden md:flex items-center gap-10">
                    <a href="#modes"
                        class="text-xs font-bold uppercase tracking-widest text-gray-500 hover:text-accent transition-colors">Intelligence</a>
                    <a href="#about"
                        class="text-xs font-bold uppercase tracking-widest text-gray-500 hover:text-accent transition-colors">About</a>
                    <a href="#community"
                        class="text-xs font-bold uppercase tracking-widest text-gray-500 hover:text-accent transition-colors">Safety</a>
                    <div class="flex items-center gap-2 bg-black/5 px-3 py-1.5 rounded-full border border-black/10">
                        <div class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-[9px] font-bold uppercase tracking-widest text-gray-700">Sentient:
                            82.4%</span>
                    </div>
                </div>

                <!-- Subtle Rewards Pill - Apple Style -->
                <div id="rewardsPill"
                    class="rewards-pill hidden sm:flex items-center gap-4 bg-black/5 rounded-full px-4 py-2 border border-black/5 cursor-pointer"
                    onclick="openRewardsShop()">
                    <!-- Coins -->
                    <div class="flex items-center gap-1.5">
                        <div class="w-3.5 h-3.5 rounded-full bg-gradient-to-br from-amber-300 to-amber-500"></div>
                        <span id="coinDisplay" class="text-[11px] font-bold text-gray-600">0</span>
                    </div>
                    <!-- Streak -->
                    <div class="flex items-center gap-1.5">
                        <div id="streakFire"
                            class="w-3.5 h-3.5 rounded-full bg-gradient-to-br from-orange-300 to-orange-500"></div>
                        <span id="streakDisplay" class="text-[11px] font-bold text-gray-600">0</span>
                    </div>
                    <!-- Level -->
                    <div class="flex items-center gap-1.5">
                        <svg id="levelRing" class="level-ring w-4 h-4" viewBox="0 0 36 36">
                            <circle cx="18" cy="18" r="14" fill="none" stroke="#d1d5db" stroke-width="4" />
                            <circle id="levelRingProgress" class="level-ring-progress" cx="18" cy="18" r="14"
                                fill="none" stroke="#6b7280" stroke-width="4" stroke-linecap="round" />
                        </svg>
                        <span id="levelDisplay" class="text-[11px] font-bold text-gray-600">1</span>
                    </div>
                </div>

                <button class="text-gray-400 hover:text-accent transition-colors haptic-pop">
                    <i data-lucide="search" class="w-5 h-5"></i>
                </button>
                <button
                    class="bg-accent text-white px-6 py-2.5 rounded-full text-[10px] font-bold uppercase tracking-widest hover:bg-black transition-all shadow-lg shadow-black/20 haptic-pop">
                    Try Beta
                </button>
            </div>
        </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobileMenu" class="hidden md:hidden glass-strong border-t border-primary/10">
            <div class="px-6 py-4 space-y-4">
                <a href="#modes" class="block text-xs font-semibold uppercase tracking-widest">AI Modes</a>
                <a href="#evolution" class="block text-xs font-semibold uppercase tracking-widest">Evolution</a>
                <a href="#reviews" class="block text-xs font-semibold uppercase tracking-widest">Trust</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="relative z-10 pt-24 pb-20 lg:pt-36 lg:pb-32 overflow-hidden">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="grid lg:grid-cols-2 gap-12 items-center">
                <div class="space-y-8 animate-fade-in">
                    <div
                        class="inline-flex items-center gap-2 px-4 py-1 rounded-full bg-black/5 text-gray-700 text-[10px] font-bold uppercase tracking-[0.2em] mb-4">
                        <span class="w-1.5 h-1.5 bg-primary rounded-full animate-pulse"></span>
                        Your AI Copilot
                    </div>

                    <h1 class="font-display text-[42px] lg:text-[56px] leading-[1.1] mb-8">
                        <span class="text-editorial-light text-gray-400 block mb-1">Find your perfect</span>
                        <span class="text-editorial-bold text-gradient block">intelligence mode</span>
                    </h1>

                    <!-- Apple-Style Search Bar -->
                    <div class="mb-10">
                        <div class="relative max-w-lg group/search">
                            <div
                                class="glass rounded-[24px] p-1.5 shadow-soft-float transition-all duration-500 group-focus-within/search:shadow-primary/20 group-focus-within/search:scale-[1.01] group-focus-within/search:ring-4 group-focus-within/search:ring-primary/5">
                                <div
                                    class="flex items-center gap-3 bg-white/60 rounded-xl px-4 py-3.5 outline-none transition-all">
                                    <div class="sentient-eyes" id="sentientEyes">
                                        <div class="sentient-eye"></div>
                                        <div class="sentient-eye"></div>
                                    </div>
                                    <input type="text" id="heroSearch" placeholder="Search intelligence modes..."
                                        class="flex-1 bg-transparent outline-none text-gray-800 placeholder-gray-400 text-sm font-medium"
                                        oninput="filterModes(this.value)" />
                                    <kbd
                                        class="hidden sm:inline-flex items-center gap-1 px-2 py-1 bg-gray-100 rounded-lg text-[10px] text-gray-500 font-medium">
                                        K
                                    </kbd>
                                </div>
                            </div>
                        </div>

                        <!-- Mode Quick Pills -->
                        <div class="flex flex-wrap gap-2 mt-4" id="modePills">
                            <button onclick="selectMode('Focus Mode')"
                                class="mode-pill px-4 py-2 rounded-full bg-accent/10 border border-accent/20 text-xs font-semibold text-accent hover:bg-accent hover:text-white transition-all">
                                 Pomodoro (25:00)
                            </button>
                            <button onclick="selectMode('Smart Tutor')"
                                class="mode-pill px-4 py-2 rounded-full bg-white/70 border border-black/5 text-xs font-semibold text-gray-600 hover:bg-white hover:border-black/10 transition-all">
                                 Smart Tutor
                            </button>
                            <button onclick="selectMode('Coding Buddy')"
                                class="mode-pill px-4 py-2 rounded-full bg-white/70 border border-black/5 text-xs font-semibold text-gray-600 hover:bg-white hover:border-black/10 transition-all">
                                 Coding Buddy
                            </button>
                            <button onclick="selectMode('Creative')"
                                class="mode-pill px-4 py-2 rounded-full bg-white/70 border border-black/5 text-xs font-semibold text-gray-600 hover:bg-white hover:border-black/10 transition-all">
                                 Creative
                            </button>
                        </div>
                    </div>

                    <!-- Navigation Arrows -->
                    <div class="flex items-center gap-3 mb-6">
                        <button onclick="navigatePhone(-1)"
                            class="w-10 h-10 rounded-full bg-white border border-black/5 shadow-sm flex items-center justify-center hover:bg-gray-50 hover:scale-105 transition-all haptic-pop">
                            <i data-lucide="chevron-left" class="w-5 h-5 text-gray-600"></i>
                        </button>
                        <div class="flex-1">
                            <p class="text-xs font-bold uppercase tracking-widest text-gray-400">Explore Modes</p>
                            <p id="currentModeName" class="text-sm font-semibold text-gray-700">Smart Tutor</p>
                        </div>
                        <button onclick="navigatePhone(1)"
                            class="w-10 h-10 rounded-full bg-white border border-black/5 shadow-sm flex items-center justify-center hover:bg-gray-50 hover:scale-105 transition-all haptic-pop">
                            <i data-lucide="chevron-right" class="w-5 h-5 text-gray-600"></i>
                        </button>
                        <div class="flex gap-1 ml-2">
                            <span id="modeIndicators" class="flex gap-1">
                                <!-- Dots injected by JS -->
                            </span>
                        </div>
                    </div>

                    <p class="text-sm text-gray-500 max-w-md leading-relaxed" id="typewriter">
                        <!-- Content injected by JS -->
                    </p>



                    <div class="flex items-center gap-4 pt-6">
                        <div class="flex -space-x-3 avatar-stack">
                            <img src="https://i.pravatar.cc/150?img=1"
                                class="w-10 h-10 rounded-full border-2 border-white shadow-sm" alt="User">
                            <img src="https://i.pravatar.cc/150?img=2"
                                class="w-10 h-10 rounded-full border-2 border-white shadow-sm" alt="User">
                            <img src="https://i.pravatar.cc/150?img=3"
                                class="w-10 h-10 rounded-full border-2 border-white shadow-sm" alt="User">
                            <img src="https://i.pravatar.cc/150?img=4"
                                class="w-10 h-10 rounded-full border-2 border-white shadow-sm" alt="User">
                        </div>
                        <div class="text-sm">
                            <div class="flex items-center gap-1 text-yellow-500">
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                            </div>
                            <p class="text-gray-500">Loved by 12,000+ beta users</p>
                        </div>
                    </div>
                </div>

                <div class="relative flex justify-center lg:justify-end animate-slide-up group">
                    <!-- iOS Device Frame -->
                    <div id="phoneFrame"
                        class="relative phone-frame aspect-[9/19.5] w-[320px] overflow-hidden ios-shadow lg:scale-105 origin-bottom">
                        <!-- Content dynamically updated by JS -->
                        <div id="phoneContent" class="h-full flex flex-col pt-8 pb-6 px-5 bg-[#F9F9F9] relative">
                            <!-- Neural Sync Overlay Badge (Sentient UI) -->
                            <div id="syncBadge"
                                class="absolute top-3 left-1/2 -translate-x-1/2 opacity-0 transition-opacity">
                                <span
                                    class="text-[7px] font-bold uppercase tracking-[0.2em] text-primary px-3 py-1 bg-white/90 rounded-full shadow-sm border border-primary/10">Neural
                                    Sync Active</span>
                            </div>

                            <!-- Header -->
                            <div class="flex items-center justify-between mb-6 shrink-0 relative z-10" id="phoneHeader">
                                <div>
                                    <p class="text-[9px] text-gray-400 font-bold uppercase tracking-widest mb-0.5"
                                        id="phoneStatus">DAISY DNA: 82%</p>
                                    <h2 class="text-lg font-bold text-gray-800" id="phoneTitle">Health Mode</h2>
                                </div>
                                <div
                                    class="w-9 h-9 rounded-full bg-pastel-pink flex items-center justify-center border-2 border-white shadow-sm overflow-hidden">
                                    <img src="https://i.pravatar.cc/100?img=47" class="w-full h-full object-cover">
                                </div>
                            </div>

                            <!-- App content placeholder -->
                            <div id="appBody" class="flex-1 flex flex-col transition-all duration-300 relative z-10">
                                <!-- Default Grid injected here or specific Mode view -->
                            </div>

                            <!-- Interaction Hint -->
                            <div id="phoneHint"
                                class="absolute bottom-10 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-20">
                                <span
                                    class="text-[8px] font-bold uppercase tracking-widest text-primary bg-white/95 px-3 py-1.5 rounded-full shadow-lg border border-primary/10">Try
                                    an Intelligence Mode</span>
                            </div>
                        </div>

                        <!-- Home Indicator -->
                        <div class="absolute bottom-2 left-1/2 -translate-x-1/2 w-32 h-1 bg-gray-300 rounded-full z-20">
                        </div>
                    </div>

                    <!-- Decorative Background for Phone -->
                    <div class="absolute -bottom-10 -right-10 w-64 h-64 bg-primary/10 rounded-full blur-[100px] -z-10">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Intelligence Suite Section -->
    <section id="modes" class="py-24 relative z-10 reveal">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="text-center max-w-3xl mx-auto mb-16">
                <div
                    class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-black/5 text-gray-500 text-[9px] font-bold uppercase tracking-widest mb-4">
                    Intelligence Suite
                </div>
                <h2 class="font-display text-4xl font-bold text-gray-900 mb-4 tracking-tight">One brain. Twelve modes.
                </h2>
                <p class="text-gray-500 text-sm max-w-lg mx-auto leading-relaxed">Daisy's DNA evolves through every
                    interaction. Explore specialized modes designed to amplify your focus.</p>
            </div>

            <!-- Intelligence Workspace -->
            <div id="suiteWorkspace" class="min-h-[500px] relative">
                <!-- Intelligence Grid -->
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 px-1" id="productsGrid">
                    <!-- Cards injected by JS -->
                </div>

            </div>
        </div>
        </div>
    </section>

    <!-- How It Works -->
    <section id="how" class="py-24 relative z-10 reveal">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="text-center max-w-3xl mx-auto mb-16">
                <div
                    class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-black/5 text-gray-700 text-[9px] font-bold uppercase tracking-widest mb-4">
                    How It Works
                </div>
                <h2 class="font-display text-3xl font-bold text-gray-900 mb-4">A Copilot That Learns You</h2>
                <p class="text-gray-500 text-sm">Daisy adapts quietly in the background while you stay in control.</p>
            </div>

            <div class="grid md:grid-cols-3 gap-6">
                <div class="glass rounded-[24px] p-6 ios-shadow">
                    <p class="text-[10px] uppercase font-bold tracking-widest text-gray-400 mb-2">01</p>
                    <h3 class="font-display text-lg font-semibold text-gray-900 mb-2">Onboard Once</h3>
                    <p class="text-sm text-gray-500">Share your goals and preferences. Daisy builds a baseline profile.
                    </p>
                </div>
                <div class="glass rounded-[24px] p-6 ios-shadow">
                    <p class="text-[10px] uppercase font-bold tracking-widest text-gray-400 mb-2">02</p>
                    <h3 class="font-display text-lg font-semibold text-gray-900 mb-2">Assist Daily</h3>
                    <p class="text-sm text-gray-500">From planning to coaching, Daisy adapts to your rhythm.</p>
                </div>
                <div class="glass rounded-[24px] p-6 ios-shadow">
                    <p class="text-[10px] uppercase font-bold tracking-widest text-gray-400 mb-2">03</p>
                    <h3 class="font-display text-lg font-semibold text-gray-900 mb-2">Evolve With You</h3>
                    <p class="text-sm text-gray-500">Your preferences sharpen. Suggestions get cleaner and faster.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Daily Quests -->
    <section id="daily-quests" class="py-24 relative z-10 reveal">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="text-center max-w-3xl mx-auto mb-16">
                <div
                    class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-black/5 text-gray-700 text-[9px] font-bold uppercase tracking-widest mb-4">
                    Daily Quest
                </div>
                <h2 class="font-display text-3xl font-bold text-gray-900 mb-4">Complete Todays Boost</h2>
                <p class="text-gray-500 text-sm">Finish all three quests for a +20 coin dopamine bonus.</p>
            </div>

            <div class="max-w-2xl mx-auto glass rounded-[26px] p-6 ios-shadow">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-semibold text-gray-900">Todays Quests</h3>
                    <span class="text-[10px] uppercase font-bold tracking-widest text-gray-400">+20 bonus</span>
                </div>
                <ul id="questList" class="space-y-3 text-sm text-gray-700"></ul>
                <div class="mt-5 w-full h-2 bg-black/10 rounded-full overflow-hidden">
                    <div id="questProgress" class="h-2 progress-gradient w-0 transition-all duration-500"></div>
                </div>
                <p id="questStatus" class="text-[10px] text-gray-400 mt-3">Complete all quests to earn the bonus.</p>
            </div>
        </div>
    </section>

    <!-- Trust & Privacy -->
    <section id="trust" class="py-24 relative z-10 reveal">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="flex flex-col lg:flex-row items-start lg:items-center gap-10">
                <div class="flex-1">
                    <div
                        class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-black/5 text-gray-700 text-[9px] font-bold uppercase tracking-widest mb-4">
                        Trust & Privacy
                    </div>
                    <h2 class="font-display text-3xl font-bold text-gray-900 mb-4">Designed for Safety by Default</h2>
                    <p class="text-gray-500 text-sm max-w-md">Control your data, manage your memory, and stay informed
                        with transparent settings.</p>
                </div>
                <div class="flex-1 grid sm:grid-cols-3 gap-4 w-full">
                    <div class="glass rounded-[20px] p-5 text-center ios-shadow">
                        <i data-lucide="shield" class="w-6 h-6 text-gray-900 mx-auto mb-3"></i>
                        <p class="text-sm font-semibold text-gray-900">Private by Design</p>
                        <p class="text-xs text-gray-500 mt-1">Clear controls and audit trails.</p>
                    </div>
                    <div class="glass rounded-[20px] p-5 text-center ios-shadow">
                        <i data-lucide="lock" class="w-6 h-6 text-gray-900 mx-auto mb-3"></i>
                        <p class="text-sm font-semibold text-gray-900">Encrypted Memory</p>
                        <p class="text-xs text-gray-500 mt-1">Your data stays protected.</p>
                    </div>
                    <div class="glass rounded-[20px] p-5 text-center ios-shadow">
                        <i data-lucide="toggle-right" class="w-6 h-6 text-gray-900 mx-auto mb-3"></i>
                        <p class="text-sm font-semibold text-gray-900">You're in Control</p>
                        <p class="text-xs text-gray-500 mt-1">Pause, review, or delete.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FAQ -->
    <section id="faq" class="py-24 relative z-10 reveal">
        <div class="max-w-3xl mx-auto px-6 lg:px-8">
            <div class="text-center mb-10">
                <div
                    class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-black/5 text-gray-700 text-[9px] font-bold uppercase tracking-widest mb-4">
                    FAQ
                </div>
                <h2 class="font-display text-3xl font-bold text-gray-900 mb-2">Answers, Clearly</h2>
                <p class="text-gray-500 text-sm">Short and direct. No fluff.</p>
            </div>
            <div class="space-y-3">
                <details class="glass rounded-[18px] p-5 ios-shadow">
                    <summary class="cursor-pointer text-sm font-semibold text-gray-900">Is Daisy a chatbot or an
                        assistant?</summary>
                    <p class="text-sm text-gray-500 mt-2">Daisy is a personal AI copilot that blends coaching, planning,
                        and memory in one place.</p>
                </details>
                <details class="glass rounded-[18px] p-5 ios-shadow">
                    <summary class="cursor-pointer text-sm font-semibold text-gray-900">Can I control what Daisy
                        remembers?</summary>
                    <p class="text-sm text-gray-500 mt-2">Yes. You can review, pause, or delete memories any time.</p>
                </details>
                <details class="glass rounded-[18px] p-5 ios-shadow">
                    <summary class="cursor-pointer text-sm font-semibold text-gray-900">Is there a free plan?</summary>
                    <p class="text-sm text-gray-500 mt-2">The beta is free while we refine the experience.</p>
                </details>
            </div>
        </div>
    </section>

    <!-- Testimonials -->
    <section id="testimonials" class="py-24 relative z-10 reveal">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="text-center max-w-3xl mx-auto mb-14">
                <div
                    class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-black/5 text-gray-700 text-[9px] font-bold uppercase tracking-widest mb-4">
                    People Love Daisy
                </div>
                <h2 class="font-display text-3xl font-bold text-gray-900 mb-2">Calm, Clear, and Useful</h2>
                <p class="text-gray-500 text-sm">Early users say Daisy feels less like software and more like support.
                </p>
            </div>

            <div class="grid md:grid-cols-3 gap-6">
                <div class="glass rounded-[22px] p-6 ios-shadow">
                    <p class="text-sm text-gray-600 leading-relaxed">The planning flow is effortless. It quietly nudges
                        me toward the right next step without noise.</p>
                    <div class="flex items-center gap-3 mt-6">
                        <img src="https://i.pravatar.cc/80?img=11" alt="Ava"
                            class="w-10 h-10 rounded-full border border-black/10" />
                        <div>
                            <p class="text-sm font-semibold text-gray-900">Ava K.</p>
                            <p class="text-xs text-gray-500">Product Designer</p>
                        </div>
                    </div>
                </div>
                <div class="glass rounded-[22px] p-6 ios-shadow">
                    <p class="text-sm text-gray-600 leading-relaxed">The memory and context are the real magic. Daisy
                        keeps everything aligned without being intrusive.</p>
                    <div class="flex items-center gap-3 mt-6">
                        <img src="https://i.pravatar.cc/80?img=22" alt="Noah"
                            class="w-10 h-10 rounded-full border border-black/10" />
                        <div>
                            <p class="text-sm font-semibold text-gray-900">Noah R.</p>
                            <p class="text-xs text-gray-500">Founder</p>
                        </div>
                    </div>
                </div>
                <div class="glass rounded-[22px] p-6 ios-shadow">
                    <p class="text-sm text-gray-600 leading-relaxed">It feels like a calm copilot. The tone is clean,
                        and the guidance is consistently helpful.</p>
                    <div class="flex items-center gap-3 mt-6">
                        <img src="https://i.pravatar.cc/80?img=31" alt="Maya"
                            class="w-10 h-10 rounded-full border border-black/10" />
                        <div>
                            <p class="text-sm font-semibold text-gray-900">Maya S.</p>
                            <p class="text-xs text-gray-500">Student</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Waitlist -->
    <section id="waitlist" class="py-24 relative z-10 reveal">
        <div class="max-w-4xl mx-auto px-6 lg:px-8">
            <div class="glass rounded-[28px] p-8 md:p-12 ios-shadow">
                <div class="flex flex-col md:flex-row items-start md:items-center gap-8">
                    <div class="flex-1">
                        <div
                            class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-black/5 text-gray-700 text-[9px] font-bold uppercase tracking-widest mb-4">
                            Early Access
                        </div>
                        <h2 class="font-display text-3xl font-bold text-gray-900 mb-3">Join the Daisy Waitlist</h2>
                        <p class="text-gray-500 text-sm">Be first to try new modes, memory features, and priority
                            support.</p>
                    </div>
                    <form id="waitlistForm" class="flex-1 w-full">
                        <div class="flex flex-col sm:flex-row gap-3">
                            <input id="waitlistEmail" type="email" placeholder="you@email.com"
                                class="w-full px-4 py-3 rounded-full border border-black/10 bg-white/80 focus:outline-none focus:ring-2 focus:ring-black/20 text-sm" />
                            <button id="waitlistSubmit" type="button"
                                class="px-6 py-3 bg-accent text-white rounded-full text-[10px] font-bold uppercase tracking-widest hover:bg-black transition-all shadow-lg shadow-black/20 haptic-pop">
                                Request Access
                            </button>
                        </div>
                        <p id="waitlistStatus" class="text-[10px] text-gray-400 mt-3">No spam. Unsubscribe anytime.</p>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="py-24 relative z-10 reveal">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="grid lg:grid-cols-2 gap-16 items-center">
                <div class="relative group">
                    <div class="aspect-square overflow-hidden rounded-[3rem] shadow-2xl relative z-10">
                        <img src="https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?w=1000&h=1000&fit=crop"
                            alt="AI Abstraction"
                            class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700">
                    </div>
                    <div
                        class="absolute -bottom-6 -right-6 w-32 h-32 bg-primary/20 rounded-full blur-3xl -z-10 animate-aurora">
                    </div>
                </div>

                <div class="space-y-6">
                    <h2 class="font-display text-4xl font-bold text-gray-800 leading-tight">The Future of Companionship
                    </h2>
                    <p class="text-gray-500 leading-relaxed text-sm">Daisy isn't just an app; she is the result of a
                        vision to make technology feel human. We believe your digital tools should be as empathetic,
                        funny, and supportive as your best friend.</p>
                    <p class="text-gray-500 leading-relaxed text-sm">By blending advanced neural networks with a
                        carefully crafted personality, we've created a copilot that doesn't just process datait
                        understands you. Whether you're coding a new project or need a midnight roast, Daisy evolves to
                        meet you exactly where you are.</p>

                    <button
                        class="px-8 py-3 bg-primary text-white text-[10px] font-bold uppercase tracking-widest rounded-full hover:bg-accent transition-all shadow-lg shadow-primary/20 haptic-pop">
                        Join the DNA Evolution
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="py-24 bg-dark/5 shadow-inner reveal">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <div class="text-center">
                    <p class="font-display text-4xl font-bold text-primary mb-1">99.9%</p>
                    <p class="text-[9px] uppercase font-bold tracking-[0.1em] text-gray-400">Response Accuracy</p>
                </div>
                <div class="text-center">
                    <p class="font-display text-4xl font-bold text-primary mb-1">24/7</p>
                    <p class="text-[9px] uppercase font-bold tracking-[0.1em] text-gray-400">Active Copilot</p>
                </div>
                <div class="text-center">
                    <p class="font-display text-4xl font-bold text-primary mb-1">12+</p>
                    <p class="text-[9px] uppercase font-bold tracking-[0.1em] text-gray-400">Intelligence Modes</p>
                </div>
                <div class="text-center">
                    <p class="font-display text-4xl font-bold text-primary mb-1">Zero</p>
                    <p class="text-[9px] uppercase font-bold tracking-[0.1em] text-gray-400">Data Sharing</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Memory Vault Section (NEW) -->
    <section id="memory" class="py-24 relative overflow-hidden reveal">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="text-center max-w-3xl mx-auto mb-16">
                <div
                    class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/10 text-primary text-[9px] font-bold uppercase tracking-widest mb-4">
                    The Memory Vault
                </div>
                <h2 class="font-display text-3xl font-bold text-gray-800 mb-4">Dynamic Memory Profile</h2>
                <p class="text-gray-500 text-sm">Every interaction is a synapse. DAISY's vault stores your shared
                    growth, making every response feel uniquely yours.</p>
            </div>

            <div class="grid md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Memory Cards -->
                <div
                    class="memory-card glass p-6 rounded-[2.5rem] bg-white border border-primary/5 hover:translate-y-[-5px] transition-all">
                    <div class="text-[10px] font-bold text-primary mb-2 uppercase tracking-tighter">Sync Moment  02:44
                        AM</div>
                    <p class="text-sm font-bold text-gray-800 mb-3">Optimization Suggestion</p>
                    <p class="text-[11px] text-gray-400 leading-relaxed italic">"Integrated React useMemo hook after
                        analyzing your state bottlenecks."</p>
                </div>
                <div
                    class="memory-card glass p-6 rounded-[2.5rem] bg-white border border-primary/5 hover:translate-y-[-5px] transition-all">
                    <div class="text-[10px] font-bold text-primary mb-2 uppercase tracking-tighter">Emotion Sync  11:21
                        PM</div>
                    <p class="text-sm font-bold text-gray-800 mb-3">Mood Baseline Adjust</p>
                    <p class="text-[11px] text-gray-400 leading-relaxed italic">"Detected elevated stress levels.
                        Switching tone to Empathy/Support."</p>
                </div>
                <div
                    class="memory-card glass p-6 rounded-[2.5rem] bg-white border border-primary/5 hover:translate-y-[-5px] transition-all">
                    <div class="text-[10px] font-bold text-primary mb-2 uppercase tracking-tighter">Recall  3 Days Ago
                    </div>
                    <p class="text-sm font-bold text-gray-800 mb-3">Project Milestones</p>
                    <p class="text-[11px] text-gray-400 leading-relaxed italic">"Remembered your goal to finish user
                        authentication before Friday."</p>
                </div>
                <div
                    class="memory-card glass p-6 rounded-[2.5rem] bg-white border border-primary/5 hover:translate-y-[-5px] transition-all">
                    <div class="text-[10px] font-bold text-primary mb-2 uppercase tracking-tighter">AI Evolution 
                        Ongoing</div>
                    <p class="text-sm font-bold text-gray-800 mb-3">DNA Synthesis</p>
                    <p class="text-[11px] text-gray-400 leading-relaxed italic">"Shared context density increased by 14%
                        this week. Intelligence Synced."</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="community" class="py-24 relative z-10 reveal">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="grid lg:grid-cols-3 gap-12">
                <div
                    class="p-8 rounded-[2.5rem] bg-white border border-primary/5 shadow-lg shadow-primary/5 hover:-translate-y-2 transition-transform">
                    <div class="w-12 h-12 bg-pastel-blue rounded-[24%] flex items-center justify-center mb-6 shadow-sm">
                        <i data-lucide="brain" class="w-6 h-6 text-blue-500"></i>
                    </div>
                    <h3 class="font-display text-xl font-bold text-gray-800 mb-4">Evolving DNA</h3>
                    <p class="text-gray-500 text-sm leading-relaxed">Daisy remembers every conversation, building a
                        unique memory profile that allows her to understand your humor, stress triggers, and goals.</p>
                </div>

                <div
                    class="p-8 rounded-[2.5rem] bg-white border border-primary/5 shadow-lg shadow-primary/5 hover:-translate-y-2 transition-transform">
                    <div class="w-12 h-12 bg-pastel-pink rounded-[24%] flex items-center justify-center mb-6 shadow-sm">
                        <i data-lucide="heart" class="w-6 h-6 text-pink-500"></i>
                    </div>
                    <h3 class="font-display text-xl font-bold text-gray-800 mb-4">Hyper Personal</h3>
                    <p class="text-gray-500 text-sm leading-relaxed">She doesn't just answer questions; she anticipates
                        needs. From suggesting a focus mode when you're busy to a roast when you need a laugh.</p>
                </div>

                <div
                    class="p-8 rounded-[2.5rem] bg-white border border-primary/5 shadow-lg shadow-primary/5 hover:-translate-y-2 transition-transform">
                    <div
                        class="w-12 h-12 bg-pastel-green rounded-[24%] flex items-center justify-center mb-6 shadow-sm">
                        <i data-lucide="shield-check" class="w-6 h-6 text-green-600"></i>
                    </div>
                    <h3 class="font-display text-xl font-bold text-gray-800 mb-4">Safe & Respectful</h3>
                    <p class="text-gray-500 text-sm leading-relaxed">Your data never leaves your device's reach. Daisy
                        is encrypted, non-judgmental, and programmed with strict safety and respect protocols.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="py-24 relative z-10 overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-primary/20 to-secondary/20 opacity-30"></div>
        <div class="max-w-5xl mx-auto px-6 lg:px-8 relative z-10 text-center">
            <h2 class="font-display text-3xl font-bold text-gray-800 mb-6">Experience the Evolution</h2>
            <p class="text-gray-500 mb-10 max-w-xl mx-auto uppercase text-xs tracking-[0.2em] font-bold">Daisy learns
                from every interaction to better serve your unique lifestyle.</p>

            <form class="flex flex-col sm:flex-row gap-4 max-w-md mx-auto mb-8"
                onsubmit="event.preventDefault(); alert('Welcome to Nomad!');">
                <input type="email" placeholder="Enter your email"
                    class="flex-1 px-6 py-4 rounded-full bg-white/10 border border-white/10 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all">
                <button type="submit"
                    class="px-8 py-4 bg-primary text-dark font-bold rounded-full hover:bg-primary/90 transition-all hover:scale-105 active:scale-95 whitespace-nowrap haptic-pop">
                    Get Started
                </button>
            </form>

            <p class="text-sm text-gray-600 dark:text-gray-500">Free forever. Upgrade anytime for premium features.</p>
        </div>
    </section>

    <!-- Footer -->
    <footer class="border-t border-white/5 pt-16 pb-8 relative z-10 glass-strong">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-8 mb-12">
                <div class="col-span-2">
                    <div class="flex items-center gap-2 mb-4">
                        <span class="font-display font-bold text-xl text-primary tracking-[0.2em]">DAISY</span>
                    </div>
                    <p
                        class="text-[10px] uppercase font-bold tracking-widest text-gray-400 leading-relaxed mb-4 max-w-xs">
                        An evolving digital companion designed to help you navigate life with ease.
                    </p>
                    <div class="flex gap-4">
                        <a href="#"
                            class="w-10 h-10 rounded-full glass flex items-center justify-center hover:bg-primary/20 hover:text-primary transition-all haptic-pop">
                            <i data-lucide="twitter" class="w-5 h-5"></i>
                        </a>
                        <a href="#"
                            class="w-10 h-10 rounded-full glass flex items-center justify-center hover:bg-primary/20 hover:text-primary transition-all haptic-pop">
                            <i data-lucide="instagram" class="w-5 h-5"></i>
                        </a>
                        <a href="#"
                            class="w-10 h-10 rounded-full glass flex items-center justify-center hover:bg-primary/20 hover:text-primary transition-all haptic-pop">
                            <i data-lucide="youtube" class="w-5 h-5"></i>
                        </a>
                    </div>
                </div>

                <div>
                    <h4 class="text-[10px] uppercase font-bold tracking-widest text-gray-800 mb-4">Intelligence</h4>
                    <ul class="space-y-2 text-[10px] uppercase font-bold tracking-widest text-gray-400">
                        <li><a href="#modes" class="hover:text-primary transition-colors">AI Modes</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">Personalization</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">Memory</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">Voice</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="text-[10px] uppercase font-bold tracking-widest text-gray-800 mb-4">Company</h4>
                    <ul class="space-y-2 text-[10px] uppercase font-bold tracking-widest text-gray-400">
                        <li><a href="#" class="hover:text-primary transition-colors">Our Mission</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">Privacy First</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">Radical Trust</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">Contact</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="text-[10px] uppercase font-bold tracking-widest text-gray-800 mb-4">Legal</h4>
                    <ul class="space-y-2 text-[10px] uppercase font-bold tracking-widest text-gray-400">
                        <li><a href="#" class="hover:text-primary transition-colors">Privacy</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">Terms</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">Cookies</a></li>
                    </ul>
                </div>
            </div>

            <div class="border-t border-white/5 pt-8 flex flex-col md:flex-row justify-between items-center gap-4">
                <p class="text-[10px] uppercase font-bold tracking-widest text-gray-400"> 2024 DAISY AI. All rights
                    reserved.</p>
                <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-500">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                    All systems operational
                </div>
            </div>
        </div>
    </footer>

    <!-- Daily Bonus Popup -->
    <div id="dailyBonusModal" class="fixed inset-0 z-[200] hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeDailyBonus()"></div>
        <div class="relative flex items-center justify-center min-h-screen p-6">
            <div class="glass rounded-[32px] p-8 max-w-sm w-full text-center ios-shadow relative overflow-hidden">
                <div class="bonus-shine absolute inset-0"></div>
                <div class="relative z-10">
                    <div class="text-6xl mb-4"></div>
                    <h3 class="font-display text-2xl font-bold text-gray-900 mb-2">Daily Bonus!</h3>
                    <p class="text-gray-500 text-sm mb-6">Welcome back! Here's your reward.</p>

                    <div class="bg-gradient-to-r from-amber-100 to-orange-100 rounded-2xl p-4 mb-6">
                        <div class="flex items-center justify-center gap-3">
                            <span class="text-3xl"></span>
                            <span id="bonusAmount" class="font-display text-4xl font-bold text-amber-600">+10</span>
                        </div>
                        <p id="bonusStreak" class="text-sm text-amber-700 mt-2">Day 1 streak bonus</p>
                    </div>

                    <div id="bonusCalendar" class="grid grid-cols-7 gap-2 mb-6">
                        <!-- Calendar days injected by JS -->
                    </div>

                    <button onclick="claimDailyBonus()"
                        class="w-full py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-2xl hover:from-amber-600 hover:to-orange-600 transition-all shadow-lg shadow-orange-500/30 haptic-pop">
                        Claim Reward
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Rewards Shop Modal -->
    <div id="rewardsShopModal" class="fixed inset-0 z-[150] hidden">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-md" onclick="closeRewardsShop()"></div>
        <div class="relative max-w-2xl mx-auto mt-16 p-6 max-h-[85vh] overflow-y-auto">
            <div class="glass rounded-[32px] p-6 ios-shadow">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h3 class="font-display text-2xl font-bold text-gray-900">Rewards Shop</h3>
                        <p class="text-sm text-gray-500">Spend coins to unlock premium features</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-2 bg-amber-50 px-4 py-2 rounded-full">
                            <span class="text-lg"></span>
                            <span id="shopCoinBalance" class="font-bold text-amber-600">0</span>
                        </div>
                        <button onclick="closeRewardsShop()" class="text-gray-400 hover:text-gray-600 haptic-pop">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Shop Categories -->
                <div class="space-y-6">
                    <!-- Themes -->
                    <div>
                        <h4 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-3"> Themes</h4>
                        <div class="grid grid-cols-2 gap-3" id="shopThemes">
                            <!-- Items injected by JS -->
                        </div>
                    </div>

                    <!-- AI Modes -->
                    <div>
                        <h4 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-3"> Premium AI Modes
                        </h4>
                        <div class="grid grid-cols-2 gap-3" id="shopModes">
                            <!-- Items injected by JS -->
                        </div>
                    </div>

                    <!-- Utilities -->
                    <div>
                        <h4 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-3"> Power-Ups</h4>
                        <div class="grid grid-cols-2 gap-3" id="shopUtilities">
                            <!-- Items injected by JS -->
                        </div>
                    </div>
                </div>

                <p class="text-[10px] text-gray-400 mt-6 text-center">Purchases are stored locally. Complete tasks to
                    earn more coins!</p>
            </div>
        </div>
    </div>

    <!-- Toasts -->
    <div id="toastContainer" class="fixed bottom-6 right-6 z-[110] space-y-2"></div>

    <!-- Theme Switcher -->
    <div class="theme-switcher">
        <div id="themePanel" class="theme-panel">
            <button class="theme-dot" data-bg="default" style="background:#f7f7f9"></button>
            <button class="theme-dot" data-bg="sand" style="background:#f4eadc"></button>
            <button class="theme-dot" data-bg="slate" style="background:#e5e7eb"></button>
            <button class="theme-dot" data-bg="olive" style="background:#eef0e6"></button>
            <button class="theme-dot" data-bg="stone" style="background:#f1f1f1"></button>
        </div>
        <button id="themeToggle"
            class="w-12 h-12 rounded-full bg-white/80 border border-white/70 shadow-lg flex items-center justify-center">
            <i data-lucide="palette" class="w-5 h-5 text-gray-700"></i>
        </button>
    </div>

    <script>
        window.DAISY_API_BASE = "http://localhost:8000";
    </script>
    <script src="api.js"></script>
    <script type="module">
        import { Dopamine } from './dopamine.js';
        import { AIModes } from './aiModes.js';
        window.Dopamine = Dopamine;
        window.AIModes = AIModes;

    </script>

    <script>
        const RewardsEngine = {
            coins: 0,
            streak: 0,
            level: 1,
            xp: 0,
            xpToNextLevel: 100,
            lastLoginDate: null,
            unlockedItems: [],
            dailyBonuses: [10, 20, 30, 50, 100, 200, 500],
            shopItems: {
                themes: [
                    { id: 'dark_mode', name: 'Obsidian Night', emoji: '', price: 0, desc: 'Pure black interface for deep focus.' },
                    { id: 'glass_mode', name: 'Glassmorphism', emoji: '', price: 100, desc: 'Frosted glass effects and soft shadows.' },
                    { id: 'bliss_mode', name: 'Summer Bliss', emoji: '', price: 250, desc: 'Warm gradients and sunset tones.' }
                ],
                modes: [
                    { id: 'zen_plus', name: 'Zen+', emoji: '', price: 500, desc: 'Advanced focus mode with bio-feedback loops.' },
                    { id: 'alpha_wave', name: 'Alpha State', emoji: '', price: 1000, desc: 'Brainwave entrainment audio integration.' }
                ],
                utilities: [
                    { id: 'double_xp', name: 'XP Booster', emoji: '', price: 300, consumable: true, desc: 'Earn double XP for the next 24 hours.' },
                    { id: 'shield', name: 'Focus Shield', emoji: '', price: 150, consumable: true, desc: 'Prevent streak loss for one missed day.' }
                ]
            },

            init() {
                this.loadState();
                this.updateUI();
                this.checkDailyBonus();
                this.renderShop();
                // Check if level ring exists
                this.updateRings();
            },

            loadState() {
                const saved = localStorage.getItem('daisyRewards');
                if (saved) {
                    const data = JSON.parse(saved);
                    this.coins = data.coins || 0;
                    this.streak = data.streak || 0;
                    this.level = data.level || 1;
                    this.xp = data.xp || 0;
                    this.lastLoginDate = data.lastLoginDate;
                    this.unlockedItems = data.unlockedItems || [];
                }
            },

            saveState() {
                localStorage.setItem('daisyRewards', JSON.stringify({
                    coins: this.coins,
                    streak: this.streak,
                    level: this.level,
                    xp: this.xp,
                    lastLoginDate: this.lastLoginDate,
                    unlockedItems: this.unlockedItems
                }));
            },

            updateUI() {
                const coinEl = document.getElementById('coinDisplay');
                const streakEl = document.getElementById('streakDisplay');
                const levelEl = document.getElementById('levelDisplay');
                const shopBalanceEl = document.getElementById('shopCoinBalance');

                if (coinEl) coinEl.textContent = this.coins.toLocaleString();
                if (streakEl) streakEl.textContent = this.streak;
                if (levelEl) levelEl.textContent = this.level;
                if (shopBalanceEl) shopBalanceEl.textContent = this.coins.toLocaleString();

                this.updateRings();
                this.animateBars();
            },

            updateRings() {
                // Main Level Progress Ring
                const levelRing = document.getElementById('levelRingProgress');
                if (levelRing) {
                    const circumference = 2 * Math.PI * 15; // r=15
                    const progress = (this.xp / this.xpToNextLevel) * 100;
                    const offset = circumference - (progress / 100) * circumference;
                    levelRing.style.strokeDasharray = `${circumference}`;
                    levelRing.style.strokeDashoffset = offset;
                }

                // Sub-metrics rings (Health, Sync, Stability)
                const rings = {
                    'ringSY': Math.min(80, 40 + (this.level * 5)),
                    'ringHL': 92,
                    'ringST': 65
                };

                for (const [id, value] of Object.entries(rings)) {
                    const el = document.getElementById(id);
                    if (el) {
                        const radius = id === 'ringSY' ? 38 : (id === 'ringHL' ? 30 : 22);
                        const circ = 2 * Math.PI * radius;
                        const off = circ - (value / 100) * circ;
                        el.style.strokeDasharray = `${circ}`;
                        el.style.strokeDashoffset = off;
                    }
                }
            },

            animateBars() {
                const bars = document.querySelectorAll('.pulse-bar');
                bars.forEach(bar => {
                    const height = Math.floor(Math.random() * 40) + 20;
                    bar.style.height = `${height}%`;
                });
            },

            addCoins(amount) {
                this.coins += amount;
                this.addXP(Math.floor(amount / 2));
                this.saveState();
                this.updateUI();

                // SILENCED: Floating coin animation removed
            },

            addXP(amount) {
                this.xp += amount;
                if (this.xp >= this.xpToNextLevel) {
                    this.levelUp();
                }
                this.saveState();
                this.updateUI();
            },

            levelUp() {
                this.level += 1;
                this.xp = this.xp - this.xpToNextLevel;
                this.xpToNextLevel = Math.floor(this.xpToNextLevel * 1.2);
                this.saveState();
                this.updateUI();

                // SILENCED: Level up popup removed
            },

            checkDailyBonus() {
                const today = new Date().toDateString();
                if (this.lastLoginDate !== today) {
                    this.streak += 1;
                    const bonus = this.dailyBonuses[Math.min(this.streak - 1, this.dailyBonuses.length - 1)];

                    // Dispatch event for UI
                    window.dispatchEvent(new CustomEvent('daisyDailyBonusAvailable', {
                        detail: { streak: this.streak, amount: bonus }
                    }));
                }
            },

            renderShop() {
                const renderItems = (items, containerId) => {
                    const container = document.getElementById(containerId);
                    if (!container) return;
                    container.innerHTML = items.map(item => {
                        const owned = this.unlockedItems.includes(item.id);
                        const canAfford = this.coins >= item.price;
                        return `
                        <div class="shop-item ${owned ? '' : (canAfford ? '' : 'locked')} 
                            bg-white rounded-2xl p-4 border border-gray-100 shadow-sm cursor-pointer"
                            onclick="RewardsEngine.purchaseItem('${item.id}', ${item.price}, ${item.consumable || false})">
                            <div class="flex items-start justify-between mb-2">
                                <span class="text-2xl">${item.emoji}</span>
                                ${owned ? '<span class="text-xs font-bold text-green-500">OWNED</span>' :
                                `<span class="flex items-center gap-1 text-sm font-bold ${canAfford ? 'text-amber-600' : 'text-gray-400'}">
                                     ${item.price}
                                </span>`}
                            </div>
                            <h5 class="font-bold text-gray-900 text-sm">${item.name}</h5>
                            <p class="text-[11px] text-gray-500 mt-1">${item.desc}</p>
                        </div>
                    `;
                    }).join('');
                };

                renderItems(this.shopItems.themes, 'shopThemes');
                renderItems(this.shopItems.modes, 'shopModes');
                renderItems(this.shopItems.utilities, 'shopUtilities');
            },

            purchaseItem(id, price, consumable) {
                if (this.unlockedItems.includes(id) && !consumable) return;
                if (this.coins < price) {
                    this.showToast("Not enough coins!", "error");
                    return;
                }

                this.coins -= price;
                if (!consumable) this.unlockedItems.push(id);
                this.saveState();
                this.updateUI();
                this.renderShop();
                this.showToast(`Purchased ${id.replace('_', ' ')}!`, "success");
            },

            showToast(message, type = 'info') {
                const container = document.getElementById('toastContainer');
                if (!container) return;

                const colors = {
                    success: 'bg-green-500',
                    error: 'bg-red-500',
                    info: 'bg-gray-800'
                };

                const toast = document.createElement('div');
                toast.className = `${colors[type]} text-white px-4 py-3 rounded-2xl shadow-lg text-sm font-medium toast-enter`;
                toast.textContent = message;

                container.appendChild(toast);

                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateY(10px)';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
        };

        window.RewardsEngine = RewardsEngine;
    </script>

    <script>
        // Daisy AI Modes data (12 Modes)
        const daisyModes = [
            {
                name: 'Smart Tutor', status: 'Expert', icon: 'graduation-cap', bg: 'bg-pastel-blue', text: 'text-blue-500',
                category: 'Study', desc: 'Step-by-step help with complex problems.'
            },
            {
                name: 'Life Coach', status: 'Active', icon: 'heart', bg: 'bg-pastel-pink', text: 'text-pink-500', category:
                    'Habits', desc: 'The gentle push you need to stay on track.'
            },
            {
                name: 'Relationship', status: 'Safe', icon: 'users', bg: 'bg-pastel-green', text: 'text-green-600', category:
                    'Advice', desc: 'Secure and respectful guidance for life.'
            },
            {
                name: 'Creative', status: 'New', icon: 'sparkles', bg: 'bg-pastel-purple', text: 'text-purple-600', category:
                    'Idea', desc: 'Unleash your imagination with AI.'
            },
            {
                name: 'Fun Mode', status: 'Witty', icon: 'smile', bg: 'bg-pastel-orange', text: 'text-orange-500', category:
                    'Laugh', desc: 'Jokes, roasts, and witty comebacks.'
            },
            {
                name: 'Coding Buddy', status: 'Pro', icon: 'code', bg: 'bg-pastel-cyan', text: 'text-cyan-600', category: 'Dev',
                desc: 'Review, debug, and write code faster.'
            },
            {
                name: 'Fitness Coach', status: 'Strong', icon: 'dumbbell', bg: 'bg-pastel-indigo', text: 'text-indigo-600',
                category: 'Workouts', desc: 'Daily routines tailored to your body.'
            },
            {
                name: 'Sleep Coach', status: 'Calm', icon: 'moon', bg: 'bg-pastel-rose', text: 'text-rose-500', category: 'Rest',
                desc: 'Optimize your recovery and dreams.'
            },
            {
                name: 'Money Guide', status: 'Smart', icon: 'piggy-bank', bg: 'bg-pastel-yellow', text: 'text-yellow-600',
                category: 'Finance', desc: 'Grow your wealth with smart insights.'
            },
            {
                name: 'Design Pro', status: 'Art', icon: 'palette', bg: 'bg-pastel-blue', text: 'text-blue-600', category:
                    'Visuals', desc: 'Create stunning designs in seconds.'
            },
            {
                name: 'Focus Mode', status: 'Flow', icon: 'brain', bg: 'bg-pastel-purple', text: 'text-purple-700', category:
                    'Mind', desc: 'Deep work and concentration boost.'
            },
            {
                name: 'Safety Mode', status: 'Secure', icon: 'shield', bg: 'bg-pastel-green', text: 'text-green-700', category:
                    'Privacy', desc: 'Military-grade encryption for chat.'
            },
        ];

        // ============================================
        //  HERO SEARCH & NAVIGATION
        // ============================================

        let currentModeIndex = 0;

        // Initialize mode indicators
        function initModeIndicators() {
            const indicators = document.getElementById('modeIndicators');
            if (!indicators) return;

            indicators.innerHTML = daisyModes.map((_, i) =>
                `<span
        class="w-1.5 h-1.5 rounded-full transition-all ${i === currentModeIndex ? 'bg-gray-800 w-3' : 'bg-gray-300'}"></span>`
            ).join('');
        }

        // Open mode in phone
        function openPhoneMode(mode) {
            appBody.classList.remove('mode-flash');
            void appBody.offsetWidth; // Trigger reflow
            appBody.classList.add('mode-flash');
            openMode(mode.name);
        }

        // Navigate phone modes
        function navigatePhone(direction) {
            currentModeIndex = (currentModeIndex + direction + daisyModes.length) % daisyModes.length;
            const mode = daisyModes[currentModeIndex];

            // Update current mode name display
            const modeNameEl = document.getElementById('currentModeName');
            if (modeNameEl) modeNameEl.textContent = mode.name;

            // Update mode tools panel (Intelligence Suite section)
            const activeTitle = document.getElementById('activeModeTitle');
            if (activeTitle) activeTitle.textContent = `${mode.name} Operations`;

            // Update indicators
            initModeIndicators();

            // Open mode in phone with flash
            openPhoneMode(mode);

            // Award coins for exploring
            if (window.RewardsEngine) {
                RewardsEngine.addCoins(2);
            }
        }

        // Select mode from search/pills
        function selectMode(modeName) {
            const modeIndex = daisyModes.findIndex(m => m.name === modeName);
            if (modeIndex !== -1) {
                currentModeIndex = modeIndex;
                initModeIndicators();

                // Update current mode name display (Hero)
                const modeNameEl = document.getElementById('currentModeName');
                if (modeNameEl) modeNameEl.textContent = modeName;

                // Update Workspace Title
                const workspaceTitle = document.getElementById('activeWorkspaceTitle');
                if (workspaceTitle) workspaceTitle.textContent = `Neural Mode: ${modeName}`;

                // Trigger Neural Loading Sequence
                const loader = document.getElementById('neuralLoader');
                const workspace = document.getElementById('neuralWorkspace');
                const taskChatPanel = document.getElementById('taskChatPanel');
                const focusModePanel = document.getElementById('focusModePanel');

                if (loader) {
                    loader.classList.add('active');
                    setTimeout(() => {
                        loader.classList.remove('active');
                        if (workspace) workspace.classList.add('active');
                        document.body.style.overflow = 'hidden'; // Lock main scroll
                    }, 1200);
                }

                if (modeName === "Focus Mode") {
                    if (taskChatPanel) taskChatPanel.classList.add('hidden');
                    if (focusModePanel) focusModePanel.classList.remove('hidden');
                    if (workspace) workspace.classList.add('nw-immersive');
                } else {
                    if (taskChatPanel) {
                        taskChatPanel.classList.remove('hidden');
                        const labels = taskChatPanel.querySelectorAll('.active-mode-name-label');
                        labels.forEach(l => l.textContent = modeName);
                    }
                    if (focusModePanel) focusModePanel.classList.add('hidden');
                    if (workspace) workspace.classList.remove('nw-immersive');
                }

                // Open mode in phone with flash
                const mode = daisyModes[modeIndex];
                openPhoneMode(mode);

                // Award coins
                if (window.RewardsEngine) {
                    RewardsEngine.addCoins(2);
                }
            }
        }

        // Mouse Parallax for Hero
        document.addEventListener('mousemove', (e) => {
            const layers = document.querySelectorAll('.hero-parallax-layer');
            const x = (window.innerWidth - e.pageX * 2) / 100;
            const y = (window.innerHeight - e.pageY * 2) / 100;

            layers.forEach(layer => {
                const speed = parseFloat(layer.getAttribute('data-speed')) || 0.05;
                const xOffset = x * speed * 20;
                const yOffset = y * speed * 20;
                layer.style.transform = `translateX(${xOffset}px) translateY(${yOffset}px)`;
            });

            // Pulse the aurora blobs slightly
            const blobs = document.querySelectorAll('.animate-aurora');
            blobs.forEach((blob, i) => {
                const blobSpeed = (i + 1) * 0.02;
                blob.style.transform = `translate(${x * blobSpeed}%, ${y * blobSpeed}%)`;
            });
        });

        // Detect Mode based on smart keywords
        const modeKeywords = {
            'Focus Mode': ['focus', 'pomodoro', 'deep work', 'timer', 'concentration', 'flow', 'productivity', 'study', 'work'],
            'Smart Tutor': ['homework', 'tutor', 'learn', 'math', 'science', 'explanation', 'school', 'academy'],
            'Coding Buddy': ['code', 'programming', 'debug', 'script', 'python', 'javascript', 'dev', 'terminal', 'logic'],
            'Fitness Coach': ['fitness', 'workout', 'gym', 'health', 'exercise', 'training', 'body', 'muscle'],
            'Sleep Coach': ['sleep', 'rest', 'dreams', 'recovery', 'night', 'calm', 'relax', 'insomnia'],
            'Money Guide': ['money', 'finance', 'invest', 'budget', 'wealth', 'stock', 'save', 'cash'],
            'Design Pro': ['design', 'ui', 'ux', 'art', 'graphics', 'palette', 'creative', 'visuals'],
            'Creative': ['creative', 'story', 'idea', 'write', 'imagination', 'spark', 'canvas'],
            'Life Coach': ['life', 'coach', 'habits', 'routine', 'goals', 'motivation', 'mindset'],
            'Relationship': ['relationship', 'love', 'dating', 'friends', 'social', 'empathy', 'safe'],
            'Fun Mode': ['fun', 'jokes', 'roast', 'humor', 'laugh', 'witty', 'games'],
            'Safety Mode': ['safety', 'privacy', 'encrypt', 'secure', 'guard', 'shield', 'lock']
        };

        function detectMode(query) {
            const q = query.toLowerCase().trim();
            if (!q) return null;

            // Check for direct mode name matches first
            const directMatch = daisyModes.find(m => m.name.toLowerCase() === q);
            if (directMatch) return directMatch.name;

            // Check keywords
            for (const [modeName, keywords] of Object.entries(modeKeywords)) {
                if (keywords.some(k => q.includes(k))) {
                    return modeName;
                }
            }
            return null;
        }

        function selectMode(modeName) {
            // Update Workspace Title
            const workspaceTitle = document.getElementById('activeWorkspaceTitle');
            if (workspaceTitle) workspaceTitle.textContent = `Neural Mode: ${modeName}`;

            // Trigger Neural Loading Sequence
            const loader = document.getElementById('neuralLoader');
            const workspace = document.getElementById('neuralWorkspace');
            const taskChatPanel = document.getElementById('taskChatPanel');
            const focusModePanel = document.getElementById('focusModePanel');

            if (loader) {
                loader.classList.add('active');
                setTimeout(() => {
                    loader.classList.remove('active');
                    if (workspace) workspace.classList.add('active');
                    document.body.style.overflow = 'hidden'; // Lock main scroll
                }, 1200);
            }

            if (modeName === "Focus Mode") {
                if (taskChatPanel) taskChatPanel.classList.add('hidden');
                if (focusModePanel) focusModePanel.classList.remove('hidden');
                if (workspace) workspace.classList.add('nw-immersive');
            } else {
                if (taskChatPanel) {
                    taskChatPanel.classList.remove('hidden');
                    const labels = taskChatPanel.querySelectorAll('.active-mode-name-label');
                    labels.forEach(l => l.textContent = modeName);
                }
                if (focusModePanel) focusModePanel.classList.add('hidden');
                if (workspace) workspace.classList.remove('nw-immersive');
            }

            // Sync phone UI if possible
            if (window.openMode) window.openMode(modeName);
        }

        // Filter modes based on search input
        function filterModes(query) {
            const pills = document.querySelectorAll('.mode-pill');
            const eyes = document.getElementById('sentientEyes');
            const lowerQuery = query.toLowerCase().trim();

            if (eyes) {
                if (query.length > 0) eyes.classList.add('searching');
                else eyes.classList.remove('searching');
            }

            if (!lowerQuery) {
                pillsContainer.innerHTML = `
                    <button onclick="selectMode('Focus Mode')"
                        class="mode-pill px-4 py-2 rounded-full bg-accent/10 border border-accent/20 text-xs font-semibold text-accent hover:bg-accent hover:text-white transition-all">
                         Pomodoro (25:00)
                    </button>
                    <button onclick="selectMode('Smart Tutor')"
                        class="mode-pill px-4 py-2 rounded-full bg-white/70 border border-black/5 text-xs font-semibold text-gray-600 hover:bg-white hover:border-black/10 transition-all">
                         Smart Tutor
                    </button>
                    <button onclick="selectMode('Coding Buddy')"
                        class="mode-pill px-4 py-2 rounded-full bg-white/70 border border-black/5 text-xs font-semibold text-gray-600 hover:bg-white hover:border-black/10 transition-all">
                         Coding Buddy
                    </button>
                    <button onclick="selectMode('Creative')"
                        class="mode-pill px-4 py-2 rounded-full bg-white/70 border border-black/5 text-xs font-semibold text-gray-600 hover:bg-white hover:border-black/10 transition-all">
                         Creative
                    </button>
                `;
                window.topSearchMatch = null;
                return;
            }

            // High priority: Direct keyword mapping
            const detectedName = detectMode(lowerQuery);
            let filteredModes = [];

            if (detectedName) {
                const detectedMode = daisyModes.find(m => m.name === detectedName);
                filteredModes.push(detectedMode);
            }

            // Secondary: Text search across all modes (excluding the detected one to avoid duplicates)
            const textMatches = daisyModes.filter(m =>
                m.name !== detectedName && (
                    m.name.toLowerCase().includes(lowerQuery) ||
                    m.category.toLowerCase().includes(lowerQuery) ||
                    m.desc.toLowerCase().includes(lowerQuery)
                )
            );

            filteredModes = [...filteredModes, ...textMatches];

            // Update pills container with filtered results
            const pillsContainer = document.getElementById('modePills');
            if (pillsContainer) {
                if (filteredModes.length > 0) {
                    const modeEmojis = {
                        'Smart Tutor': '', 'Life Coach': '', 'Relationship': '',
                        'Creative': '', 'Fun Mode': '', 'Coding Buddy': '',
                        'Fitness Coach': '', 'Sleep Coach': '', 'Money Guide': '',
                        'Design Pro': '', 'Focus Mode': '', 'Safety Mode': ''
                    };

                    pillsContainer.innerHTML = filteredModes.slice(0, 6).map(mode => {
                        // Check if this was a keyword match
                        let label = `${modeEmojis[mode.name] || ''} ${mode.name}`;
                        const keywords = modeKeywords[mode.name] || [];
                        const matchedKeyword = keywords.find(k => k === lowerQuery || lowerQuery.includes(k));

                        if (matchedKeyword && matchedKeyword.toLowerCase() !== mode.name.toLowerCase()) {
                            label = `${modeEmojis[mode.name] || ''} ${mode.name} (${matchedKeyword})`;
                        }

                        // Explicitly add time if it's Pomodoro/Focus
                        if (mode.name === 'Focus Mode') {
                            label = ` Pomodoro (25:00)`;
                        }

                        return `
                        <button onclick="selectMode('${mode.name}')"
                            class="mode-pill px-4 py-2 rounded-full bg-white/70 border border-black/5 text-xs font-semibold text-gray-600 hover:bg-white hover:border-black/10 transition-all">
                            ${label}
                        </button>
                        `;
                    }).join('');
                } else {
                    pillsContainer.innerHTML = `<span class="text-xs text-gray-400 py-2">No matching intelligence found...</span>`;
                }
            }

            // Store the top result for "Enter" key handling
            window.topSearchMatch = filteredModes.length > 0 ? filteredModes[0].name : null;
        }

        // Keyboard shortcut for search
        document.addEventListener('keydown', (e) => {
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                const searchInput = document.getElementById('heroSearch');
                if (searchInput) {
                    searchInput.focus();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            initModeIndicators();
        });

        // Typewriter Effect
        const typewriterElement = document.getElementById('typewriter');
        const phrases = [
            "One focus block. One reward.",
            "Small wins. Clean streaks."
        ];
        let phraseIndex = 0;
        let charIndex = 0;
        let isDeleting = false;

        function type() {
            const currentPhrase = phrases[phraseIndex];
            if (isDeleting) {
                typewriterElement.textContent = currentPhrase.substring(0, charIndex--);
            } else {
                typewriterElement.textContent = currentPhrase.substring(0, charIndex++);
            }

            if (!isDeleting && charIndex === currentPhrase.length + 1) {
                setTimeout(() => isDeleting = true, 2500);
            } else if (isDeleting && charIndex === 0) {
                isDeleting = false;
                phraseIndex = (phraseIndex + 1) % phrases.length;
            }
            setTimeout(type, isDeleting ? 30 : 60);
        }

        // Phone Interactions
        const appBody = document.getElementById('appBody');
        const phoneFrame = document.getElementById('phoneFrame');
        const phoneTitle = document.getElementById('phoneTitle');
        const phoneStatus = document.getElementById('phoneStatus');

        const defaultPhoneContent = `
        <div class="bg-gray-200/50 rounded-xl px-4 py-2 flex items-center gap-3 mb-6">
            <i data-lucide="search" class="w-4 h-4 text-gray-400"></i>
            <span class="text-xs text-gray-400">Search Modes</span>
        </div>
        <div class="grid grid-cols-3 gap-4 overflow-y-auto pb-12 hide-scrollbar">
            ${daisyModes.map(mode => `
            <div class="aspect-square ${mode.bg} rounded-[24%] flex items-center justify-center shadow-sm cursor-pointer hover:scale-110 active:scale-95 transition-all duration-300 group/icon haptic-pop"
                onclick="openMode('${mode.name}')">
                <i data-lucide="${mode.icon}"
                    class="w-7 h-7 ${mode.text} group-hover/icon:rotate-12 transition-transform"></i>
            </div>
            `).join('')}
        </div>
        <div class="mt-auto pt-4 border-t border-gray-100 flex justify-between items-center px-4 shrink-0">
            <i data-lucide="home"
                class="w-5 h-5 text-primary cursor-pointer active:scale-90 transition-transform haptic-pop"
                onclick="resetPhone()"></i>
            <i data-lucide="activity" class="w-5 h-5 text-gray-300 haptic-pop"></i>
            <i data-lucide="message-circle" class="w-5 h-5 text-gray-300 haptic-pop"></i>
            <i data-lucide="settings" class="w-5 h-5 text-gray-300 haptic-pop"></i>
        </div>
        `;

        function resetPhone() {
            appBody.style.opacity = '0';
            setTimeout(() => {
                phoneTitle.textContent = "Home Intelligence";
                phoneStatus.textContent = "DAISY DNA: 82%";
                document.getElementById('syncBadge').style.opacity = '0';
                document.documentElement.style.setProperty('--primary', '#ff4d6d');
                appBody.innerHTML = defaultPhoneContent;
                lucide.createIcons();
                appBody.style.opacity = '1';
                phoneFrame.style.transform = 'scale(1) rotate(0deg)';
                phoneFrame.style.background = 'white';
            }, 300);
        }

        window.openMode = (name) => {
            const mode = daisyModes.find(m => m.name === name);
            appBody.style.opacity = '0';
            setTimeout(() => {
                phoneTitle.textContent = mode.name;
                phoneStatus.textContent = `Evolution: ${mode.status}`;
                if (mode.name === "Focus Mode") {
                    appBody.innerHTML = `
                        <div class="flex-1 flex flex-col pt-2 overflow-y-auto hide-scrollbar">
                            <div class="w-full aspect-[16/10] rounded-2xl bg-[#F6EAC2] flex flex-col items-center justify-center mb-6 shadow-inner shrink-0 relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-24 h-24 bg-white/40 rounded-full blur-2xl translate-x-4 -translate-y-4"></div>
                                <i data-lucide="brain" class="w-12 h-12 text-amber-600 animate-pulse relative z-10"></i>
                                <span class="text-[8px] font-bold text-amber-900/40 uppercase tracking-widest mt-2 relative z-10">Neural Hub Ready</span>
                            </div>
                            <div class="px-1">
                                <p class="text-[9px] text-amber-600 uppercase font-bold tracking-widest mb-1">Deep Work Protocol</p>
                                <p class="text-xs text-gray-600 leading-relaxed mb-8">Initiate neural synchronization to mirror your focus block on this device.</p>
                                <div class="space-y-3">
                                    <button class="w-full py-3.5 bg-gray-900 text-white font-bold rounded-2xl text-[10px] uppercase tracking-widest shadow-xl hover:bg-gray-800 transition-colors haptic-pop"
                                        onclick="startChat('Focus Mode')">
                                        Launch Neural Sync
                                    </button>
                                    <button class="w-full py-3.5 bg-white border border-gray-200 text-gray-500 font-bold rounded-2xl text-[10px] uppercase tracking-widest"
                                        onclick="resetPhone()">
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    appBody.innerHTML = `
                        <div class="flex-1 flex flex-col pt-2 overflow-y-auto hide-scrollbar">
                            <div
                                class="w-full aspect-[16/10] rounded-2xl ${mode.bg} flex items-center justify-center mb-6 shadow-inner shrink-0">
                                <i data-lucide="${mode.icon}" class="w-12 h-12 ${mode.text} animate-bounce"></i>
                            </div>
                            <div class="px-1">
                                <p class="text-[9px] text-gray-400 uppercase font-bold tracking-widest mb-1">${mode.category}</p>
                                <p class="text-sm text-gray-600 leading-relaxed mb-8">${mode.desc}</p>

                                <div class="space-y-3">
                                    <button
                                        class="w-full py-3.5 bg-gray-900 text-white font-bold rounded-2xl text-[10px] uppercase tracking-widest shadow-xl hover:bg-gray-800 transition-colors haptic-pop"
                                        onclick="startChat('${mode.name}')">
                                        Launch Sentient Chat
                                    </button>
                                    <button
                                        class="w-full py-3.5 bg-white border border-gray-200 text-gray-500 font-bold rounded-2xl text-[10px] uppercase tracking-widest hover:bg-gray-50 transition-colors haptic-pop"
                                        onclick="resetPhone()">
                                        Back to Menu
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
                lucide.createIcons();
                appBody.style.opacity = '1';
                phoneFrame.style.transform = 'scale(1.02) rotate(1deg)';
            }, 300);
        };

        window.startChat = (modeName) => {
            // Neural Sync: Scroll main page and select mode
            selectMode(modeName);

            const mode = daisyModes.find(m => m.name === modeName);
            appBody.style.opacity = '0';
            phoneFrame.style.background = '#F9F9F9';

            // Neural Sync: Update Page Accent Color
            const modeColors = {
                'Smart Tutor': '#3B82F6',
                'Life Coach': '#EC4899',
                'Relationship': '#10B981',
                'Creative': '#8B5CF6',
                'Fun Mode': '#F59E0B',
                'Coding Buddy': '#06B6D4',
                'Fitness Coach': '#6366F1',
                'Sleep Coach': '#F43F5E',
                'Money Guide': '#EAB308',
                'Design Pro': '#3B82F6',
                'Focus Mode': '#8B5CF6',
                'Safety Mode': '#059669'
            };
            const newColor = modeColors[modeName] || '#ff4d6d';
            document.documentElement.style.setProperty('--primary', newColor);

            setTimeout(() => {
                phoneTitle.textContent = modeName === "Focus Mode" ? "Focus Protocol" : "Daisy Chat";
                phoneStatus.textContent = modeName === "Focus Mode" ? "Neural Sync: Active" : "Establishing Bond...";
                document.getElementById('syncBadge').style.opacity = '1';

                if (modeName === "Focus Mode") {
                    appBody.innerHTML = `
                        <div class="flex-1 flex flex-col items-center justify-center p-4">
                            <!-- Minimal Timer Preview -->
                            <div class="relative w-40 h-40 flex items-center justify-center mb-6">
                                <svg class="w-full h-full transform -rotate-90">
                                    <circle cx="80" cy="80" r="70" stroke="#e5e5e5" stroke-width="6" fill="none" />
                                    <circle id="phoneFocusRing" cx="80" cy="80" r="70" stroke="#5856d6" stroke-width="6" fill="none"
                                        stroke-dasharray="440" stroke-dashoffset="0" stroke-linecap="round"
                                        class="transition-all duration-1000 ease-linear" />
                                </svg>
                                <div class="absolute text-center">
                                    <div id="phoneFocusTimer" class="text-3xl font-semibold text-gray-900 tracking-tight" style="font-variant-numeric: tabular-nums;">25:00</div>
                                    <div class="text-[9px] font-medium text-gray-400 mt-1 uppercase tracking-wider">Focus</div>
                                </div>
                            </div>
                            
                            <!-- GitHub Squares Preview -->
                            <div class="w-full mb-4 px-2">
                                <div class="grid grid-cols-7 gap-1">
                                    ${generateMiniSquares()}
                                </div>
                                <p class="text-[8px] text-gray-400 text-center mt-2">4 sessions this week</p>
                            </div>
                            
                            <div class="w-full space-y-2">
                                <button class="w-full py-3 bg-[#5856d6] text-white rounded-xl text-[10px] font-semibold tracking-wide flex items-center justify-center gap-2"
                                    onclick="openFullPomodoro()">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    Start Focus Session
                                </button>
                                <button class="w-full py-2.5 bg-white border border-gray-200 text-gray-500 rounded-xl text-[10px] font-medium"
                                    onclick="resetPhone()">
                                    Back
                                </button>
                            </div>
                        </div>
                    `;
                } else {
                    appBody.innerHTML = `
                        <div class="flex-1 flex flex-col gap-4 pt-2">
                            <div class="bg-gray-100 p-4 rounded-t-2xl rounded-br-2xl self-start max-w-[85%] border border-gray-200">
                                <p class="text-[11px] text-gray-700 leading-relaxed">Hey there! I'm initializing my <b>${modeName}</b>
                                    sub-module. Ready to dive deep into our session?</p>
                            </div>
                            <div class="bg-primary/5 p-4 rounded-t-2xl rounded-bl-2xl self-end max-w-[85%] border border-primary/10">
                                <p class="text-[11px] text-primary leading-relaxed italic">DNA Sequence Synced. I'm ready.</p>
                            </div>

                            <!-- Voice Pulse Visualizer -->
                            <div class="mt-4 flex flex-col items-center gap-3">
                                <div class="flex items-center gap-1.5 h-6">
                                    <div class="voice-bar"></div>
                                    <div class="voice-bar" style="animation-delay: 0.1s; height: 12px"></div>
                                    <div class="voice-bar" style="animation-delay: 0.2s; height: 18px"></div>
                                    <div class="voice-bar" style="animation-delay: 0.3s; height: 10px"></div>
                                    <div class="voice-bar" style="animation-delay: 0.4s; height: 14px"></div>
                                </div>
                                <span class="text-[8px] text-primary font-bold uppercase tracking-[0.2em]">Neural Sync Active</span>
                            </div>

                            <div class="mt-auto pb-4">
                                <div
                                    class="bg-white border border-gray-200 rounded-2xl p-3 flex items-center justify-between shadow-sm">
                                    <span class="text-[10px] text-gray-400">Syncing thoughts...</span>
                                    <i data-lucide="send" class="w-4 h-4 text-primary"></i>
                                </div>
                            </div>
                        </div>
                    `;
                }
                lucide.createIcons();
                appBody.style.opacity = '1';
                IntegratedPomodoro.updateUI(); // Immediate sync update if timer is already running
                phoneFrame.style.transform = 'scale(1.05) rotate(0deg)';
                appBody.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 400);
        };

        // Scroll Effects
        const navbar = document.getElementById('navbar');
        const navContainer = document.getElementById('navContainer');
        const dnaBar = document.getElementById('dnaBar');

        window.addEventListener('scroll', () => {
            const scroll = window.scrollY;

            // Navbar Shrink
            if (scroll > 50) {
                navbar.classList.add('glass-strong', 'shadow-lg');
                navContainer.classList.remove('h-20');
                navContainer.classList.add('h-16');
            } else {
                navbar.classList.remove('glass-strong', 'shadow-lg');
                navContainer.classList.remove('h-16');
                navContainer.classList.add('h-20');
            }

            // DNA Bar Progress
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            // Map scroll to 82% - 95% range
            const dnaPercent = 82 + (scrolled * 0.13);
            dnaBar.style.width = dnaPercent + "%";
        });

        // Intersection Observer for Reveal
        const revealObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('active');
                    // Also support the manual opacity/transform logic from the second script
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.reveal').forEach(el => revealObserver.observe(el));

        // Initialize Everything
        function initApp() {
            // Render main grid (bottom section)
            const mainGrid = document.getElementById('productsGrid');
            if (mainGrid) {
                mainGrid.innerHTML = '';
                daisyModes.forEach((mode, index) => {
                    const card = document.createElement('div');
                    card.className = `glass rounded-[2.5rem] overflow-hidden card-hover group cursor-pointer p-8 bg-white/70 flex flex-col items-center text-center ios-shadow border border-white/40 backdrop-blur-md`;
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                    card.style.transition = `all 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) ${index * 0.1}s`;

                    card.innerHTML = `
                        <div class="w-20 h-20 ${mode.bg} rounded-[28%] flex items-center justify-center mb-6 shadow-sm group-hover:scale-110 group-hover:rotate-3 transition-transform duration-500 ring-4 ring-white/50">
                            <i data-lucide="${mode.icon}" class="w-10 h-10 ${mode.text}"></i>
                        </div>
                        <h3 class="font-display text-base font-bold text-gray-800 mb-1 leading-tight">${mode.name}</h3>
                        <p class="text-[10px] text-gray-400 uppercase font-bold tracking-[0.2em] mb-3">${mode.category}</p>
                        <p class="text-[11px] text-gray-500 leading-relaxed line-clamp-2">${mode.desc}</p>
                    `;
                    card.onclick = () => selectMode(mode.name);
                    mainGrid.appendChild(card);
                    revealObserver.observe(card);
                });
            }

            initModeIndicators();
            if (typeof resetPhone === 'function') resetPhone();
            if (typeof type === 'function') setTimeout(type, 1000);
            lucide.createIcons();

            // Re-initialize reveals for all marked elements
            document.querySelectorAll('.reveal').forEach(el => revealObserver.observe(el));

            // Rewards Engine Init
            if (window.RewardsEngine) window.RewardsEngine.init();
        }

        document.addEventListener('DOMContentLoaded', initApp);

        function showModeTools(modeName) {
            // Deprecated: handled inside selectMode now
        }

        function exitNeuralWorkspace() {
            const workspace = document.getElementById('neuralWorkspace');
            const loader = document.getElementById('neuralLoader');

            if (loader) {
                loader.querySelector('p').textContent = "Unlinking Neural Streams...";
                loader.classList.add('active');

                setTimeout(() => {
                    if (workspace) {
                        workspace.classList.remove('active');
                        workspace.classList.remove('pomo-active');
                    }
                    loader.classList.remove('active');
                    document.body.style.overflow = 'auto'; // Unlock scroll
                    // Reset loader text for next time
                    setTimeout(() => {
                        loader.querySelector('p').textContent = "Establishing Neural Link...";
                    }, 500);
                }, 1000);
            }

            resetPhone();
        }

        function exitModeWorkspace() {
            const grid = document.getElementById('productsGrid');
            const tools = document.getElementById('modeTools');
            if (grid) grid.classList.remove('hidden');
            if (tools) tools.classList.add('hidden');

            // Scroll back to center of suite
            const workspace = document.getElementById('suiteWorkspace');
            if (workspace) workspace.scrollIntoView({ behavior: 'smooth', block: 'center' });

            if (typeof resetPhone === 'function') resetPhone();
        }
        let pendingTheme = localStorage.getItem("daisy_theme");

        const coinBalanceEl = document.getElementById('coinBalance');
        const streakCountEl = document.getElementById('streakCount');
        const levelValueEl = document.getElementById('levelValue');
        const levelBadgeEl = document.getElementById('levelBadge');
        const rewardCoinsEl = document.getElementById('rewardCoins');
        const rewardLevelEl = document.getElementById('rewardLevel');
        const rewardStreakEl = document.getElementById('rewardStreak');
        const streakFlameEl = document.getElementById('streakFlame');
        const rewardProgressEl = document.getElementById('rewardProgress');
        const rewardProgressTextEl = document.getElementById('rewardProgressText');
        const streakWarningEl = document.getElementById('streakWarning');
        const coinsTodayEl = document.getElementById('coinsToday');
        const focusMinutesTodayEl = document.getElementById('focusMinutesToday');
        const streakDaysStatEl = document.getElementById('streakDaysStat');
        const levelProgressTextEl = document.getElementById('levelProgressText');
        const levelProgressBarEl = document.getElementById('levelProgressBar');

        function animateCounter(el, from, to, duration = 600) {
            if (!el) return;
            const start = performance.now();
            const range = to - from;
            function tick(now) {
                const progress = Math.min((now - start) / duration, 1);
                const value = Math.round(from + range * progress);
                el.textContent = value;
                if (progress < 1) requestAnimationFrame(tick);
            } requestAnimationFrame(tick);
        } function playCoinSound() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)(); const osc = ctx.createOscillator(); const
                    gain = ctx.createGain(); osc.type = "sine"; osc.frequency.value = 880; gain.gain.value = 0.0001; osc.connect(gain);
                gain.connect(ctx.destination); osc.start(); gain.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime +
                    0.02); gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.25); osc.stop(ctx.currentTime +
                        0.26);
            } catch (_) {
                // Audio may be blocked; ignore.
            }
        }

        function showToast(message, type = "success") {
            const container = document.getElementById('toastContainer'); if (!container) return; const
                toast = document.createElement('div'); const color = type === "error" ? "bg-red-500/90" : "bg-black/90";
            toast.className = `toast-enter ${color} text-white text-xs px-4 py-3 rounded-full shadow-lg`;
            toast.textContent = message; container.appendChild(toast); setTimeout(() => toast.remove(), 2800);
        }

        function triggerRewardAnimation(amount, bonus = 0) {
            const layer = document.getElementById('rewardLayer');
            if (!layer || amount <= 0) return; const float = document.createElement('div');
            float.className = 'coin-float text-lg'; float.style.left = '50%'; float.style.top = '60%';
            float.style.transform = 'translateX(-50%)'; float.textContent = `+${amount} coins`;
            layer.appendChild(float); const
                sparkleCount = document.documentElement.classList.contains('confetti-enabled') ? 18 : 8; for (let i = 0; i <
                    sparkleCount; i += 1) {
                const sparkle = document.createElement('div'); sparkle.className = 'sparkle';
                sparkle.style.left = `${50 + (Math.random() * 10 - 5)}%`; sparkle.style.top = `${60 + (Math.random() * 10 -
                    5)}%`; layer.appendChild(sparkle); setTimeout(() => sparkle.remove(), 900);
            }

            setTimeout(() => float.remove(), 1200);

            if (bonus > 0) {
                showToast(`Lucky bonus +${bonus}!`);
            }

            if (window.Dopamine) {
                const cx = window.innerWidth / 2;
                const cy = window.innerHeight * 0.6;
                window.Dopamine.floatCoins(cx, cy, `+${amount}`);
                window.Dopamine.sparkleBurst(cx, cy, bonus > 0 ? 16 : 10);
            }
        }

        function showAnimeWidget(text = "Nice! +5") {
            const widget = document.createElement('div');
            widget.className = 'anime-widget';
            widget.innerHTML = `
                <div class="anime-badge"></div>
                <div>
                    <p class="text-sm font-semibold text-gray-800">${text}</p>
                    <p class="text-[10px] text-gray-500">Keep the streak alive</p>
                </div>
                `;
            document.body.appendChild(widget);
            setTimeout(() => widget.remove(), 1600);
        }

        function updateBalanceUI(balance, announce = false) {
            const delta = balance.coins - currentCoins;
            if (announce && delta > 0) {
                showToast(`+${delta} coins earned`);
                playCoinSound();
            }
            animateCounter(coinBalanceEl, currentCoins, balance.coins);
            animateCounter(rewardCoinsEl, currentCoins, balance.coins);
            currentCoins = balance.coins;

            if (streakCountEl) streakCountEl.textContent = balance.streak;
            if (levelValueEl) levelValueEl.textContent = balance.level;
            if (levelBadgeEl) levelBadgeEl.textContent = balance.level;
            if (rewardLevelEl) rewardLevelEl.textContent = balance.level;
            if (rewardStreakEl) rewardStreakEl.textContent = balance.streak;
            if (streakFlameEl) {
                const scale = Math.min(1.6, 1 + balance.streak * 0.05);
                streakFlameEl.style.transform = `scale(${scale})`;
            }

            if (levelProgressTextEl) levelProgressTextEl.textContent = `${balance.level_progress}/100`;
            if (levelProgressBarEl) {
                const width = Math.min((balance.level_progress / 100) * 100, 100);
                levelProgressBarEl.style.width = `${width}%`;
            }
            if (rewardProgressEl) {
                const width = Math.min((balance.level_progress / 100) * 100, 100);
                rewardProgressEl.style.width = `${width}%`;
            }
            if (rewardProgressTextEl) rewardProgressTextEl.textContent = `${balance.level_progress}/100`;

            if (coinsTodayEl) coinsTodayEl.textContent = balance.coins_today ?? 0;
            if (focusMinutesTodayEl) focusMinutesTodayEl.textContent = balance.focus_minutes_today ?? 0;
            if (streakDaysStatEl) streakDaysStatEl.textContent = balance.streak;

            const today = new Date().toISOString().slice(0, 10);
            const isActiveToday = balance.last_active_date === today;
            if (streakWarningEl) {
                streakWarningEl.classList.toggle('hidden', isActiveToday);
                if (!isActiveToday) window.Dopamine?.streakWarning?.(streakWarningEl);
            }

            themeUnlocked = balance.theme_unlocked;
            if (themeUnlocked && pendingTheme === "pastel") {
                applyTheme("pastel");
            } else if (!themeUnlocked) {
                applyTheme("default");
            }
            renderShopItems(balance.unlocks);
            applyUnlocks(balance.unlocks);
        }

        async function refreshBalance(announce = false) {
            if (!window.DaisyAPI) return;
            try {
                const balance = await DaisyAPI.getBalance();
                updateBalanceUI(balance, announce);
            } catch (err) {
                showToast(err.message || "Failed to load balance", "error");
            }
        }

        async function refreshHistory() {
            if (!window.DaisyAPI) return;
            try {
                const data = await DaisyAPI.history();
                const tasksEl = document.getElementById('historyTasks');
                const pomosEl = document.getElementById('historyPomodoros');
                const calendarEl = document.getElementById('streakCalendar');

                if (tasksEl) {
                    tasksEl.innerHTML = '';
                    if (!data.tasks.length) {
                        tasksEl.innerHTML = '<li class="text-gray-400">No tasks yet.</li>';
                    } else {
                        data.tasks.slice(0, 6).forEach((t) => {
                            const item = document.createElement('li');
                            item.className = 'flex items-center justify-between';
                            const label = t.type.replace(/_/g, ' ');
                            item.innerHTML = `<span class="text-gray-700">${label}</span><span
                    class="text-gray-400 text-xs">+${t.coins}</span>`;
                            tasksEl.appendChild(item);
                        });
                    }
                }

                if (pomosEl) {
                    pomosEl.innerHTML = '';
                    if (!data.pomodoros.length) {
                        pomosEl.innerHTML = '<li class="text-gray-400">No sessions yet.</li>';
                    } else {
                        data.pomodoros.slice(0, 6).forEach((p) => {
                            const item = document.createElement('li');
                            item.className = 'flex items-center justify-between';
                            item.innerHTML = `<span class="text-gray-700">${p.duration} min</span><span
                    class="text-gray-400 text-xs">+${p.coins}</span>`;
                            pomosEl.appendChild(item);
                        });
                    }
                }

                if (calendarEl) {
                    calendarEl.innerHTML = '';
                    const today = new Date();
                    const activeDates = new Set();
                    data.tasks.forEach((t) => activeDates.add(t.timestamp.slice(0, 10)));
                    data.pomodoros.forEach((p) => activeDates.add(p.completed_at.slice(0, 10)));
                    for (let i = 6; i >= 0; i -= 1) {
                        const d = new Date(today);
                        d.setDate(today.getDate() - i);
                        const dateStr = d.toISOString().slice(0, 10);
                        const cell = document.createElement('div');
                        const active = activeDates.has(dateStr);
                        cell.className = `h-9 rounded-lg flex items-center justify-center border ${active ? 'bg-black text-white border-black/80' : 'bg-white/70 text-gray-500 border-black/10'}`;
                        cell.textContent = dateStr.slice(5);
                        calendarEl.appendChild(cell);
                    }
                }

                const weeklyChart = document.getElementById('weeklyChart');
                if (weeklyChart) {
                    weeklyChart.innerHTML = '';
                    const today = new Date();
                    const totals = [];
                    for (let i = 6; i >= 0; i -= 1) {
                        const d = new Date(today);
                        d.setDate(today.getDate() - i);
                        const dateStr = d.toISOString().slice(0, 10);
                        const taskCoins = data.tasks
                            .filter((t) => t.timestamp.slice(0, 10) === dateStr)
                            .reduce((sum, t) => sum + (t.coins || 0), 0);
                        const pomoCoins = data.pomodoros
                            .filter((p) => p.completed_at.slice(0, 10) === dateStr)
                            .reduce((sum, p) => sum + (p.coins || 0), 0);
                        totals.push(taskCoins + pomoCoins);
                    }
                    const max = Math.max(10, ...totals);
                    totals.forEach((val) => {
                        const bar = document.createElement('div');
                        bar.className = 'bg-black/10 rounded-md';
                        bar.style.height = `${Math.max(12, (val / max) * 96)}px`;
                        bar.style.background = 'linear-gradient(180deg, rgba(15,17,21,0.15) 0%, rgba(15,17,21,0.5) 100%)';
                        weeklyChart.appendChild(bar);
                    });
                }
            } catch (_) {
                // History is non-critical; ignore errors.
            }
        }

        async function refreshQuests() {
            if (!window.DaisyAPI) return;
            const list = document.getElementById('questList');
            const progress = document.getElementById('questProgress');
            const status = document.getElementById('questStatus');
            try {
                const quests = await DaisyAPI.dailyQuestStatus();
                if (list) list.innerHTML = '';
                const total = quests.items.length;
                const done = quests.items.filter((q) => q.done).length;
                const percent = total ? Math.round((done / total) * 100) : 0;
                if (progress) progress.style.width = `${percent}%`;
                if (status) status.textContent = quests.bonus_awarded
                    ? "Bonus claimed. Great work today."
                    : "Complete all quests to earn the bonus.";

                quests.items.forEach((q) => {
                    const li = document.createElement('li');
                    li.className = 'flex items-center gap-3';
                    li.innerHTML = `
                <input type="checkbox" ${q.done ? "checked" : ""} data-quest="${q.id}"
                    class="w-4 h-4 rounded border-black/20 text-black focus:ring-black/20" />
                <span class="${q.done ? 'line-through text-gray-400' : 'text-gray-700'}">${q.label}</span>
                `;
                    list?.appendChild(li);
                });

                list?.querySelectorAll('input[type="checkbox"]').forEach((box) => {
                    box.addEventListener('change', async (e) => {
                        const id = e.target.getAttribute('data-quest');
                        const done = e.target.checked;
                        await DaisyAPI.setQuestDone(id, done);
                        const res = await DaisyAPI.completeDailyQuests();
                        if (res.daily_bonus) {
                            showToast("Daily quest complete! +20 coins");
                            triggerRewardAnimation(res.reward.total, res.reward.bonus);
                            showAnimeWidget("Quest complete! +20");
                            await refreshBalance(true);
                        }
                        await refreshQuests();
                    });
                });
            } catch (_) {
                // ignore
            }
        }

        function applyTheme(theme) {
            const root = document.documentElement;
            if (theme === "pastel") {
                root.classList.add("theme-pastel");
                localStorage.setItem("daisy_theme", "pastel");
                pendingTheme = "pastel";
            } else {
                root.classList.remove("theme-pastel");
                localStorage.setItem("daisy_theme", "default");
                pendingTheme = "default";
            }
        }

        const shopCatalog = [
            {
                id: "pastel", name: "Pastel Premium Theme", cost: 50, desc: "Soft gradients and a calmer mood.",
                reason: "theme_unlock"
            },
            {
                id: "glow", name: "Glow Hover Effects", cost: 80, desc: "Extra glow on interactive elements.", reason:
                    "glow_unlock"
            },
            {
                id: "confetti", name: "Confetti Reward Burst", cost: 120, desc: "Celebrate wins with confetti.",
                reason: "confetti_unlock"
            },
            {
                id: "avatar", name: "Avatar Frame", cost: 60, desc: "Cute frame for your profile card.", reason:
                    "avatar_unlock"
            },
        ];

        function renderShopItems(unlocks) {
            const container = document.getElementById('shopItems');
            if (!container) return;
            container.innerHTML = '';
            shopCatalog.forEach((item) => {
                const unlocked = !!unlocks?.[item.id];
                const card = document.createElement('div');
                card.className = 'glass rounded-[20px] p-5 flex items-center justify-between relative overflow-hidden';
                card.innerHTML = `
                        <div>
                            <p class="text-sm font-semibold text-gray-900">${item.name}</p>
                            <p class="text-xs text-gray-500">${item.desc}</p>
                            <p class="text-[10px] uppercase font-bold tracking-widest text-gray-400 mt-2">Cost: ${item.cost} coins</p>
                        </div>
                        ${unlocked ? '<span class="absolute top-3 right-3 text-[9px] uppercase font-bold tracking-widest bg-green-500/90 text-white px-2 py-1 rounded-full">Unlocked</span>'
                        : '<span class="absolute top-3 right-3 text-[9px] uppercase font-bold tracking-widest bg-black/80 text-white px-2 py-1 rounded-full">Locked</span>'}
                        <button data-shop="${item.id}" class="px-4 py-2.5 ${unlocked ? 'glass text-gray-900' : 'bg-accent text-white'} rounded-full text-[10px] font-bold uppercase tracking-widest hover:bg-black transition-all haptic-pop">
                            ${unlocked ? 'Apply' : 'Unlock'}
                        </button>
                    `;
                container.appendChild(card);
            });
        }

        function applyUnlocks(unlocks) {
            const root = document.documentElement;
            root.classList.toggle('glow-enabled', !!unlocks?.glow);
            root.classList.toggle('confetti-enabled', !!unlocks?.confetti);
            root.classList.toggle('avatar-enabled', !!unlocks?.avatar);
        }

        // Integrated Focus Mode Logic (Study Focus)
        const IntegratedPomodoro = {
            timer: null,
            timeLeft: 25 * 60,
            duration: 25 * 60,
            focusDuration: 25 * 60,
            breakDuration: 5 * 60,
            mode: 'focus', // 'focus' or 'break'
            isRunning: false,
            sessionsCompleted: 0,
            autoBreak: true,
            autoResume: false,
            goalTarget: 4,

            init() {
                this.loadState();
                this.updateUI();
                this.setupListeners();
            },

            loadState() {
                const saved = localStorage.getItem('daisy_focus_history');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        this.sessionsCompleted = data.sessionsCompleted || 0;
                        const logContainer = document.getElementById('focusLog');
                        if (logContainer && data.history && data.history.length > 0) {
                            logContainer.innerHTML = '';
                            data.history.forEach(entry => this.appendLogEntry(entry.title, entry.time, entry.timestamp));
                        }
                        this.updateSessionCount();
                    } catch (e) { console.error("Failed to load focus history", e); }
                }

                const preset = localStorage.getItem('daisy_focus_preset');
                if (preset) {
                    try {
                        const data = JSON.parse(preset);
                        this.setPreset(data.focus, data.break, false);
                    } catch (_) { }
                }

                const autoBreak = localStorage.getItem('daisy_auto_break');
                if (autoBreak !== null) {
                    this.autoBreak = autoBreak === 'true';
                }

                const autoResume = localStorage.getItem('daisy_auto_resume');
                if (autoResume !== null) {
                    this.autoResume = autoResume === 'true';
                }
            },

            saveState() {
                const logContainer = document.getElementById('focusLog');
                const history = Array.from(logContainer.querySelectorAll('.focus-entry')).map(el => ({
                    title: el.querySelector('.entry-title').textContent,
                    time: el.querySelector('.entry-time').textContent,
                    timestamp: el.querySelector('.entry-timestamp').textContent
                }));
                localStorage.setItem('daisy_focus_history', JSON.stringify({
                    sessionsCompleted: this.sessionsCompleted,
                    history: history
                }));
            },

            setupListeners() {
                const toggleBtn = document.getElementById('focusToggle');
                const resetBtn = document.getElementById('focusReset');
                const skipBtn = document.getElementById('focusSkip');

                toggleBtn?.addEventListener('click', () => this.toggle());
                resetBtn?.addEventListener('click', () => this.reset());
                skipBtn?.addEventListener('click', () => this.skip());

                document.querySelectorAll('.nw-preset').forEach((btn) => {
                    btn.addEventListener('click', () => {
                        const focus = Number(btn.getAttribute('data-focus')) || 25;
                        const brk = Number(btn.getAttribute('data-break')) || 5;
                        this.setPreset(focus, brk, true);
                        document.querySelectorAll('.nw-preset').forEach((b) => b.classList.remove('active'));
                        btn.classList.add('active');
                    });
                });

                const autoBreakBtn = document.getElementById('autoBreakToggle');
                if (autoBreakBtn) {
                    autoBreakBtn.classList.toggle('active', this.autoBreak);
                    autoBreakBtn.addEventListener('click', () => {
                        this.autoBreak = !this.autoBreak;
                        autoBreakBtn.classList.toggle('active', this.autoBreak);
                        localStorage.setItem('daisy_auto_break', `${this.autoBreak}`);
                    });
                }

                const autoResumeBtn = document.getElementById('autoResumeToggle');
                if (autoResumeBtn) {
                    autoResumeBtn.classList.toggle('active', this.autoResume);
                    autoResumeBtn.addEventListener('click', () => {
                        this.autoResume = !this.autoResume;
                        autoResumeBtn.classList.toggle('active', this.autoResume);
                        localStorage.setItem('daisy_auto_resume', `${this.autoResume}`);
                    });
                }

                document.addEventListener('keydown', (e) => {
                    const tag = document.activeElement?.tagName?.toLowerCase();
                    if (tag === 'input' || tag === 'textarea') return;
                    if (e.code === 'Space') {
                        e.preventDefault();
                        this.toggle();
                    }
                    if (e.key.toLowerCase() === 'r') this.reset();
                    if (e.key.toLowerCase() === 's') this.skip();
                });
            },

            toggle() {
                if (this.isRunning) {
                    this.pause();
                } else {
                    this.start();
                }
            },

            start() {
                if (this.isRunning) return;
                this.isRunning = true;
                this.playSound('play');
                document.getElementById('focusModePanel')?.classList.add('timer-active');
                this.timer = setInterval(() => {
                    if (this.timeLeft > 0) {
                        this.timeLeft--;
                        this.updateUI();
                    } else {
                        this.complete();
                    }
                }, 1000);
            },

            pause() {
                this.isRunning = false;
                document.getElementById('focusModePanel')?.classList.remove('timer-active');
                clearInterval(this.timer);
                this.updateToggleButton();
            },

            reset() {
                this.pause();
                this.timeLeft = this.duration;
                this.updateUI();
            },

            skip() {
                const confirmed = confirm("Skip this session?");
                if (confirmed) {
                    this.timeLeft = 0;
                    this.complete();
                }
            },

            complete() {
                this.pause();
                const workspace = document.getElementById('neuralWorkspace');
                if (workspace) {
                    workspace.classList.add('session-complete');
                    setTimeout(() => workspace.classList.remove('session-complete'), 1200);
                }

                if (this.mode === 'focus') {
                    this.sessionsCompleted++;
                    this.awardRewards();
                    this.logSession('Deep Work', `${Math.round(this.focusDuration / 60)}m`);
                    this.saveState();

                    showToast(`Session Complete! ${Math.round(this.focusDuration / 60)}m  ${this.sessionsCompleted}/${this.goalTarget}`, "success");

                    if (this.autoBreak) {
                        this.mode = 'break';
                        this.duration = this.breakDuration;
                        this.timeLeft = this.duration;
                        showToast(`Break started. Relax for ${Math.round(this.breakDuration / 60)} mins.`, "info");
                    } else {
                        this.mode = 'focus';
                        this.duration = this.focusDuration;
                        this.timeLeft = this.duration;
                        showToast("Ready for the next session.", "info");
                    }
                } else {
                    // Switch to focus
                    this.mode = 'focus';
                    this.duration = this.focusDuration;
                    this.timeLeft = this.duration;
                    showToast("Break over. Back to focus!", "info");
                    if (this.autoResume) this.start();
                }

                this.updateUI();
                this.updateNeuralSync();
            },

            awardRewards() {
                if (window.RewardsEngine) {
                    RewardsEngine.addCoins(10);
                    RewardsEngine.addXP(20);
                }
            },

            logSession(title, time) {
                this.appendLogEntry(title, time, new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
                this.updateSessionCount();
            },

            appendLogEntry(title, time, timestamp) {
                const logContainer = document.getElementById('focusLog');
                if (!logContainer) return;

                if (logContainer.querySelector('.focus-placeholder')) {
                    logContainer.innerHTML = '';
                }

                const entry = document.createElement('div');
                entry.className = 'focus-entry flex items-center gap-3 px-4 py-2 rounded-full bg-white/70 border border-black/5 text-sm text-gray-700 whitespace-nowrap animate-fade-in';
                entry.innerHTML = `
                    <span class="entry-title text-sm font-medium">${title}</span>
                    <span class="entry-time text-xs text-gray-500">${time}</span>
                    <span class="entry-timestamp text-xs text-gray-400">${timestamp}</span>
                `;
                logContainer.prepend(entry);
                lucide.createIcons();
            },

            updateSessionCount() {
                const countEl = document.getElementById('sessionCount');
                if (countEl) countEl.textContent = `${this.sessionsCompleted} Session${this.sessionsCompleted !== 1 ? 's' : ''}`;
                const goalCountEl = document.getElementById('goalCount');
                const goalProgressEl = document.getElementById('goalProgress');
                if (goalCountEl) goalCountEl.textContent = `${this.sessionsCompleted} / ${this.goalTarget}`;
                if (goalProgressEl) {
                    const pct = Math.min(100, (this.sessionsCompleted / this.goalTarget) * 100);
                    goalProgressEl.style.width = `${pct}%`;
                }
            },

            updateUI() {
                const timerEl = document.getElementById('focusTimer');
                const progressEl = document.getElementById('focusProgress');
                const modeEl = document.getElementById('pomodoroModeDisplay');

                const mins = Math.floor(this.timeLeft / 60);
                const secs = this.timeLeft % 60;
                const timeStr = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

                if (timerEl) {
                    timerEl.textContent = timeStr;
                }

                if (progressEl) {
                    const progress = this.timeLeft / this.duration;
                    const percent = Math.max(0, Math.min(100, progress * 100));
                    progressEl.style.width = `${percent}%`;
                    const ring = document.getElementById('focusRing');
                    if (ring) ring.style.setProperty('--ring-progress', `${percent}%`);
                }

                if (modeEl) {
                    modeEl.textContent = this.mode === 'focus' ? 'Focus' : 'Break';
                    const container = document.getElementById('pomodoroModeDisplayContainer');
                    if (container) {
                        container.className = "pm-mode-chip";
                    }
                    modeEl.className = "";
                }

                this.updateNeuralSync(timeStr);
                const cycleEl = document.getElementById('cycleDisplay');
                if (cycleEl) cycleEl.textContent = `${Math.round(this.focusDuration / 60)} / ${Math.round(this.breakDuration / 60)}`;
            },

            updateNeuralSync(timeStr) {
                const phoneBody = document.getElementById('appBody');
                if (!phoneBody || !phoneBody.querySelector('.neural-sync-active')) return;

                const phoneTimer = phoneBody.querySelector('#phoneFocusTimer');
                const phoneRing = phoneBody.querySelector('#phoneFocusRing');

                if (phoneTimer) phoneTimer.textContent = timeStr || "25:00";

                if (phoneRing) {
                    const circumference = 534; // radius 85 in phone mockup
                    const progress = this.timeLeft / this.duration;
                    const offset = circumference * (1 - progress);
                    phoneRing.style.strokeDashoffset = offset;
                }
            },

            updateToggleButton() {
                const iconEl = document.getElementById('focusIcon');
                if (iconEl) {
                    iconEl.setAttribute('data-lucide', this.isRunning ? 'pause' : 'play');
                    lucide.createIcons();
                }
                const toggleBtn = document.getElementById('focusToggle');
                if (toggleBtn) toggleBtn.classList.toggle('is-playing', this.isRunning);
                const workspace = document.getElementById('neuralWorkspace');
                if (workspace) workspace.classList.toggle('session-active', this.isRunning);
                this.updateNeuralSync();
            },

            setPreset(focusMinutes, breakMinutes, persist = true) {
                this.focusDuration = Math.max(5, focusMinutes) * 60;
                this.breakDuration = Math.max(1, breakMinutes) * 60;
                this.duration = this.mode === 'focus' ? this.focusDuration : this.breakDuration;
                this.timeLeft = this.duration;
                if (persist) {
                    localStorage.setItem('daisy_focus_preset', JSON.stringify({
                        focus: focusMinutes,
                        break: breakMinutes
                    }));
                }
                this.updateUI();
            }
        };

        // Initialize IntegratedPomodoro
        IntegratedPomodoro.init();

        const focusQuotes = [
            "Small steps. Quiet focus. Big results.",
            "Do the work. Let the noise fade.",
            "One session at a time.",
            "Focus is a choice you make every minute.",
            "Start simple. Finish strong.",
            "Silence the rest. Keep the promise.",
            "Progress loves consistency.",
            "Make this minute count."
        ];

        function rotateQuote() {
            const el = document.getElementById('motivationQuote');
            if (!el) return;
            const next = focusQuotes[Math.floor(Math.random() * focusQuotes.length)];
            el.textContent = next;
        }

        rotateQuote();
        setInterval(rotateQuote, 60000);

        async function completeTask() {
            try {
                const reward = await DaisyAPI.spendCoins({ amount: 0, reason: "task_complete" });
                triggerRewardAnimation(reward.total, reward.bonus);
                showAnimeWidget(`Task done! + ${reward.total || 5} `);
                if (window.AIModes) {
                    await window.AIModes.applyModeReward({
                        baseCoins: 0,
                        reason: "task",
                        DaisyAPI: window.DaisyAPI,
                        Dopamine: window.Dopamine,
                        onReward: (amt, bonus) => triggerRewardAnimation(amt, bonus),
                    });
                }
                await refreshBalance(true);
                await refreshHistory();
                await refreshQuests();
            } catch (err) {
                showToast(err.message || "Task failed", "error");
            }
        }

        async function sendChat() {
            const input = document.getElementById('chatInputWorkspace');
            const display = document.getElementById('chatDisplay');
            const text = input?.value?.trim();
            if (!text || !display) return;

            // Append User Message
            const userMsg = document.createElement('div');
            userMsg.className = "bg-black text-white p-6 rounded-[40px] rounded-tr-none self-end max-w-[85%] border border-black/10 shadow-lg animate-fade-in";
            userMsg.innerHTML = `<p class="text-base leading-relaxed">${text}</p>`;
            display.appendChild(userMsg);
            display.scrollTop = display.scrollHeight;

            input.value = "";

            try {
                const res = await DaisyAPI.aiChat({ message: text });
                const mode = window.AIModes?.getMode?.() || "Motivator";
                const context = { coins: currentCoins, streak: streakCountEl?.textContent || 0, prompted: true };
                const localReply = window.AIModes?.generateResponse?.(mode, context);
                const replyText = localReply || res.reply;

                // Append Daisy Message
                const daisyMsg = document.createElement('div');
                daisyMsg.className = "bg-white/70 p-6 rounded-[32px] rounded-tl-none self-start max-w-[85%] border border-black/5 shadow-sm animate-fade-in";
                daisyMsg.innerHTML = `<p class="text-base text-gray-700 leading-relaxed font-medium">${replyText}</p>`;
                display.appendChild(daisyMsg);
                display.scrollTop = display.scrollHeight;

                await refreshBalance(true);
                await refreshHistory();
                await refreshQuests();
            } catch (err) {
                showToast(err.message || "Chat failed", "error");
            }
        }

        function initShopModal() {
            const openBtn = document.getElementById('openShop');
            const closeBtn = document.getElementById('closeShop');
            const modal = document.getElementById('shopModal');
            const container = document.getElementById('shopItems');

            openBtn?.addEventListener('click', async () => {
                modal?.classList.remove('hidden');
                try {
                    const balance = await DaisyAPI.getBalance();
                    renderShopItems(balance.unlocks);
                } catch (_) {
                    // ignore
                }
            });
            closeBtn?.addEventListener('click', () => modal?.classList.add('hidden'));
            modal?.addEventListener('click', (e) => {
                if (e.target === modal) modal.classList.add('hidden');
            });
            container?.addEventListener('click', async (e) => {
                const btn = e.target.closest('button[data-shop]');
                if (!btn) return;
                const id = btn.getAttribute('data-shop');
                const item = shopCatalog.find((i) => i.id === id);
                if (!item) return;

                try {
                    const balance = await DaisyAPI.getBalance();
                    const isUnlocked = balance.unlocks?.[item.id];
                    if (isUnlocked) {
                        if (id === "pastel") applyTheme("pastel");
                        if (id === "glow") document.documentElement.classList.add('glow-enabled');
                        if (id === "confetti") document.documentElement.classList.add('confetti-enabled');
                        if (id === "avatar") document.documentElement.classList.add('avatar-enabled');
                        showToast("Applied!");
                        return;
                    }
                    await DaisyAPI.spendCoins({ amount: item.cost, reason: item.reason });
                    if (item.id === "pastel") applyTheme("pastel");
                    window.Dopamine?.shopUnlock?.(item.name);
                    showToast("Unlocked!");
                    await refreshBalance(true);
                } catch (err) {
                    showToast(err.message || "Unlock failed", "error");
                }
            });
        }

        function initActions() {
            const searchInput = document.getElementById('heroSearch');
            searchInput?.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && window.topSearchMatch) {
                    selectMode(window.topSearchMatch);
                    searchInput.blur();
                }
            });

            document.getElementById('completeTaskBtn')?.addEventListener('click', completeTask);
            document.getElementById('chatSendBtnWorkspace')?.addEventListener('click', sendChat);
        }

        function initAIModes() {
            const select = document.getElementById('aiModeSelect');
            if (!select || !window.AIModes) return;
            select.value = window.AIModes.getMode();
            select.addEventListener('change', (e) => {
                window.AIModes.setMode(e.target.value);
                showToast(`Mode: ${e.target.value}`);
            });
        }

        function initThemeSwitcher() {
            const panel = document.getElementById('themePanel');
            const toggle = document.getElementById('themeToggle');
            const saved = localStorage.getItem('daisy_bg') || 'default';
            document.body.setAttribute('data-bg', saved);

            toggle?.addEventListener('click', () => {
                panel?.classList.toggle('active');
            });

            panel?.querySelectorAll('.theme-dot').forEach((dot) => {
                dot.addEventListener('click', (e) => {
                    const bg = e.currentTarget.getAttribute('data-bg');
                    document.body.setAttribute('data-bg', bg);
                    localStorage.setItem('daisy_bg', bg);
                    panel.classList.remove('active');
                });
            });
        }

        function initWaitlist() {
            const btn = document.getElementById('waitlistSubmit');
            const input = document.getElementById('waitlistEmail');
            const status = document.getElementById('waitlistStatus');
            btn?.addEventListener('click', async () => {
                const email = input?.value?.trim();
                if (!email) return;
                if (status) status.textContent = "Submitting...";
                try {
                    await DaisyAPI.waitlist({ email });
                    if (status) status.textContent = "You're in. Welcome to the waitlist.";
                    if (input) input.value = "";
                } catch (err) {
                    if (status) status.textContent = err.message || "Unable to submit.";
                }
            });
        }

        (async function initGamification() {
            initActions();
            initAIModes();
            initShopModal();
            initWaitlist();
            initThemeSwitcher();
            pendingTheme = localStorage.getItem("daisy_theme");
            if (window.DaisyAPI?.unlockAll) await window.DaisyAPI.unlockAll();
            if (window.DaisyAPI?.enableUnlimitedCoins) await window.DaisyAPI.enableUnlimitedCoins();
            refreshBalance(false);
            refreshHistory();
            refreshQuests();
        })();

        // Soundscape Engine
        const SoundEngine = {
            activeSound: null,
            audioCtx: null,
            oscillators: [],
            currentTrackIndex: 0,
            playlist: [
                {
                    title: 'Clair de Lune',
                    artist: 'Claude Debussy',
                    url: 'https://upload.wikimedia.org/wikipedia/commons/b/b8/Debussy_-_Clair_de_Lune.mp3'
                },
                {
                    title: 'Gymnopdie No. 1',
                    artist: 'Erik Satie',
                    url: 'https://upload.wikimedia.org/wikipedia/commons/3/3d/Gymnopedie_No._1.mp3'
                },
                {
                    title: 'Nocturne Op. 9 No. 2',
                    artist: 'Frdric Chopin',
                    url: 'https://upload.wikimedia.org/wikipedia/commons/4/4b/Nocturne_in_E_flat_major%2C_Op._9_no._2.mp3'
                }
            ],

            init() {
                if (!this.audioCtx) {
                    this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (this.audioCtx.state === 'suspended') {
                    this.audioCtx.resume();
                }
            },

            play(index = null) {
                this.init();
                this.stop();

                if (index !== null) this.currentTrackIndex = index;
                const track = this.playlist[this.currentTrackIndex];

                // Update UI Metadata
                const trackEl = document.getElementById('pomoTrackName');
                const artistEl = document.getElementById('pomoArtistName');
                if (trackEl) trackEl.textContent = track.title;
                if (artistEl) artistEl.textContent = track.artist;

                const audio = new Audio();
                audio.src = track.url;
                audio.loop = true;
                audio.volume = 0.5;
                audio.preload = "auto";

                if (window.DaisyAPI) window.DaisyAPI.showNotification(`Loading ${track.title}...`, 'info');

                // Add loading timeout
                this.loadTimeout = setTimeout(() => {
                    if (audio.readyState < 2) {
                        console.error('Music load timeout:', track.title);
                        if (window.DaisyAPI) window.DaisyAPI.showNotification(`Network slow: ${track.title} is taking a while.`, 'warning');
                    }
                }, 10000);

                audio.addEventListener('canplay', () => {
                    clearTimeout(this.loadTimeout);
                    audio.play().then(() => {
                        if (window.DaisyAPI) window.DaisyAPI.showNotification(`Playing: ${track.title}`, 'success');
                        this.startTracking();
                    }).catch(err => {
                        console.error('Music playback blocked:', err);
                        if (window.DaisyAPI) window.DaisyAPI.showNotification('Playback blocked. Click anywhere to enable music.', 'warning');
                        this.stop();
                    });
                }, { once: true });

                audio.addEventListener('timeupdate', () => {
                    if (this.onProgress) this.onProgress(audio.currentTime, audio.duration);
                });

                audio.addEventListener('error', (e) => {
                    clearTimeout(this.loadTimeout);
                    console.error('Audio source error:', e);
                    if (window.DaisyAPI) window.DaisyAPI.showNotification('Failed to load track. Connection interrupted.', 'error');
                    this.stop();
                });

                audio.load(); // Explicit load
                this.activeSound = { music: audio, type: 'music' };
            },

            loadTimeout: null,

            onProgress: null,

            seek(percent) {
                if (this.activeSound && this.activeSound.music) {
                    const audio = this.activeSound.music;
                    audio.currentTime = audio.duration * (percent / 100);
                }
            },

            startTracking() {
                PomoTimer.isMusicPlaying = true;
                PomoTimer.updateMusicUI(true);
            },

            stop() {
                if (this.activeSound) {
                    if (this.activeSound.music) {
                        this.activeSound.music.pause();
                        this.activeSound.music.src = "";
                    }
                    this.activeSound = null;
                }
                PomoTimer.isMusicPlaying = false;
                PomoTimer.updateMusicUI(false);
            },
        };

        function toggleSound(type, btn) {
            PomoTimer.toggleZen(type, btn);
        }

        function toggleBreatheMode() {
            const overlay = document.getElementById('breatheOverlay');
            if (!overlay) return;

            if (overlay.style.opacity === '1') {
                overlay.style.opacity = '0';
                overlay.style.pointerEvents = 'none';
            } else {
                overlay.style.opacity = '1';
                overlay.style.pointerEvents = 'auto';
            }
        }

    </script>

    <!-- Neural Loading Overlay -->
    <div id="neuralLoader" class="neural-loader">
        <div class="dna-helix">
            <div class="dna-bar" style="animation-delay: 0.1s"></div>
            <div class="dna-bar" style="animation-delay: 0.2s"></div>
            <div class="dna-bar" style="animation-delay: 0.3s"></div>
            <div class="dna-bar" style="animation-delay: 0.4s"></div>
            <div class="dna-bar" style="animation-delay: 0.5s"></div>
            <div class="dna-bar" style="animation-delay: 0.6s"></div>
            <div class="dna-bar" style="animation-delay: 0.7s"></div>
            <div class="dna-bar" style="animation-delay: 0.8s"></div>
        </div>
        <p class="mt-6 text-[10px] font-bold uppercase tracking-[0.3em] text-primary animate-pulse">Establishing Neural
            Link...</p>
    </div>

    <!-- Virtual Page Workspace -->
    <div id="neuralWorkspace">
        <div class="nw-bg"></div>
        <div class="nw-shell">
            <div class="nw-header">
                <button onclick="exitNeuralWorkspace()"
                    class="group flex items-center gap-3 px-5 py-3 bg-white border border-black/5 rounded-2xl text-[10px] font-semibold uppercase tracking-widest hover:bg-black hover:text-white transition-all haptic-pop">
                    <i data-lucide="arrow-left" class="w-4 h-4 group-hover:-translate-x-1 transition-transform"></i>
                    Exit
                </button>
                <div class="nw-status">
                    <span class="nw-status-dot"></span>
                    <div>
                        <p class="nw-kicker">Neural Workspace</p>
                        <span id="activeWorkspaceTitle" class="nw-title">Focus Protocol</span>
                    </div>
                </div>
            </div>

            <div class="nw-grid">
                <section id="focusModePanel" class="nw-panel hidden pomo-container" data-theme="sunset">
                    <div id="pomoSpotlight" class="pomo-spotlight"></div>
                    <div class="pomo-liquid-container">
                        <div id="pomoLiquidFill" class="pomo-liquid-fill">
                            <div class="pomo-wave"></div>
                        </div>
                    </div>
                    <div id="pomoVictoryAura" class="victory-aura"></div>
                    <div class="pomo-shell">
                        <!-- Left Panel - Timer -->
                        <div class="pomo-main">
                            <div class="pomo-header">
                                <div class="pomo-header-left">
                                    <button class="pomo-back-btn" onclick="exitNeuralWorkspace()">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M15 19l-7-7 7-7" />
                                        </svg>
                                    </button>
                                    <span class="pomo-title">Focus Timer</span>
                                    <button class="pomo-theme-toggle" onclick="PomoTimer.toggleTheme()"
                                        title="Toggle Dark Mode">
                                        <svg id="pomoThemeIcon" class="w-4 h-4" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path class="sun-icon" stroke-linecap="round" stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707.707M6.364 17.364l-.707.707M6.364 6.364l-.707-.707m12.728 12.728l-.707-.707M12 8a4 4 0 100 8 4 4 0 000-8z" />
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <div class="pomo-timer-wrap">
                                <!-- Mode Tabs -->
                                <div class="pomo-mode-tabs">
                                    <button class="pomo-mode-tab active"
                                        onclick="PomoTimer.setMode('focus')">Focus</button>
                                    <button class="pomo-mode-tab" onclick="PomoTimer.setMode('short')">Short
                                        Break</button>
                                    <button class="pomo-mode-tab" onclick="PomoTimer.setMode('long')">Long
                                        Break</button>
                                </div>

                                <!-- Clean Timer Display - No Ring -->
                                <div class="pomo-time-container">
                                    <div id="pomoTimeDisplay" class="pomo-time">25:00</div>
                                    <div id="pomoSessionLabel" class="pomo-session-label">Focus Session</div>
                                </div>

                                <!-- Controls -->
                                <div class="pomo-controls">
                                    <button class="pomo-btn pomo-btn-secondary" onclick="PomoTimer.reset()">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                        </svg>
                                    </button>
                                    <button id="pomoPlayBtn" class="pomo-btn pomo-btn-primary"
                                        onclick="PomoTimer.toggle()">
                                        <svg id="pomoPlayIcon" class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M8 5v14l11-7z" />
                                        </svg>
                                    </button>
                                    <button class="pomo-btn pomo-btn-secondary" onclick="PomoTimer.skip()">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M13 5l7 7-7 7M5 5l7 7-7 7" />
                                        </svg>
                                    </button>
                                </div>

                                <!-- Stats Row -->
                                <div class="pomo-stats-row">
                                    <div class="pomo-stat">
                                        <div id="pomoSessionCount" class="pomo-stat-value">0</div>
                                        <div class="pomo-stat-label">Sessions</div>
                                    </div>
                                    <div class="pomo-stat">
                                        <div id="pomoTotalTime" class="pomo-stat-value">0m</div>
                                        <div class="pomo-stat-label">Focus Time</div>
                                    </div>
                                    <div class="pomo-stat">
                                        <div id="pomoStreak" class="pomo-stat-value">0</div>
                                        <div class="pomo-stat-label">Day Streak</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Panel - GitHub Squares + Notes -->
                        <div class="pomo-sidebar">
                            <div class="pomo-sidebar-header">
                                <div class="pomo-sidebar-title">Focus History</div>
                                <div class="pomo-sidebar-subtitle">Track your productivity</div>
                            </div>

                            <!-- GitHub Contribution Squares -->
                            <div class="pomo-contrib-section">
                                <div class="pomo-contrib-header">
                                    <span class="pomo-contrib-title">Last 5 Weeks</span>
                                    <span id="pomoContribCount" class="pomo-contrib-count">0 sessions</span>
                                </div>
                                <div id="pomoSquaresGrid" class="pomo-squares-grid">
                                    <!-- Squares generated by JS -->
                                </div>
                                <div class="pomo-legend">
                                    <span>Less</span>
                                    <div class="pomo-legend-square" style="background: rgba(0,0,0,0.04)"></div>
                                    <div class="pomo-legend-square" style="background: #9be9a8"></div>
                                    <div class="pomo-legend-square" style="background: #40c463"></div>
                                    <div class="pomo-legend-square" style="background: #30a14e"></div>
                                    <div class="pomo-legend-square" style="background: #216e39"></div>
                                    <span>More</span>
                                </div>
                            </div>

                            <!-- Today's Stats -->
                            <div class="pomo-today-card">
                                <div class="pomo-today-row">
                                    <div class="pomo-today-item">
                                        <div id="pomoTodaySessions" class="pomo-today-value">0</div>
                                        <div class="pomo-today-label">Sessions</div>
                                    </div>
                                    <div class="pomo-today-item">
                                        <div id="pomoTodayMinutes" class="pomo-today-value">0</div>
                                        <div class="pomo-today-label">Minutes</div>
                                    </div>
                                    <div class="pomo-today-item">
                                        <div id="pomoTodayGoal" class="pomo-today-value">0%</div>
                                        <div class="pomo-today-label">Goal</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Composer Portal (Music Player) -->
                            <div class="pomo-composer-section">
                                <div class="pomo-sidebar-subtitle">Now Playing</div>
                                <div class="pomo-music-player">
                                    <div class="pomo-player-info">
                                        <div class="pomo-player-icon">
                                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                                <path
                                                    d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z" />
                                            </svg>
                                        </div>
                                        <div class="pomo-player-text">
                                            <div id="pomoTrackName" class="pomo-track-name">Clair de Lune</div>
                                            <div id="pomoArtistName" class="pomo-artist-name">Claude Debussy</div>
                                        </div>
                                    </div>
                                    <div class="pomo-player-controls">
                                        <div class="pomo-nav-btn" onclick="PomoTimer.prevTrack()">
                                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z" />
                                            </svg>
                                        </div>
                                        <div id="pomoMusicToggle" class="pomo-play-pause-btn"
                                            onclick="PomoTimer.toggleMusic()">
                                            <svg id="pomoMusicIcon" class="w-5 h-5" fill="currentColor"
                                                viewBox="0 0 24 24">
                                                <path d="M8 5v14l11-7z" />
                                            </svg>
                                        </div>
                                        <div class="pomo-nav-btn" onclick="PomoTimer.nextTrack()">
                                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z" />
                                            </svg>
                                        </div>
                                        <div class="pomo-progress-wrap" onclick="PomoTimer.seekMusic(event)">
                                            <div id="pomoMusicProgress" class="pomo-progress-bar"></div>
                                        </div>
                                        <div id="pomoMusicTime" class="pomo-player-time">0:00</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Notes Section (Current) -->
                            <div class="pomo-notes-section">
                                <div class="pomo-notes-header">
                                    <span class="pomo-notes-title">Current Focus Journal</span>
                                    <button class="pomo-notes-clear" onclick="PomoTimer.clearNotes()">Clear</button>
                                </div>
                                <textarea id="pomoNotesTextarea" class="pomo-notes-textarea"
                                    placeholder="What are you working on right now?"></textarea>
                            </div>

                            <!-- Timeline section (Past) -->
                            <div class="pomo-timeline-section">
                                <div class="pomo-sidebar-subtitle">Recent Insights</div>
                                <div id="pomoTimeline" class="pomo-timeline">
                                    <!-- Logs generated by JS -->
                                    <div class="pomo-log-item">
                                        <div class="pomo-log-text opacity-40">Your productivity timeline will appear
                                            here...</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Duration Buttons -->
                            <div class="pomo-quick-actions">
                                <button class="pomo-quick-btn active" onclick="PomoTimer.setDuration(25)">25m</button>
                                <button class="pomo-quick-btn" onclick="PomoTimer.setDuration(45)">45m</button>
                                <button class="pomo-quick-btn" onclick="PomoTimer.setDuration(60)">60m</button>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="taskChatPanel" class="nw-panel hidden">
                    <div class="nw-panel-header">
                        <div>
                            <p class="nw-kicker">Neural Dialogue</p>
                            <h2 class="nw-heading">Task Copilot</h2>
                        </div>
                    </div>
                    <div id="chatDisplay" class="nw-chat-display space-y-6 mb-8 hide-scrollbar">
                        <div
                            class="bg-white p-5 rounded-[20px] rounded-tl-none self-start max-w-[85%] border border-black/5">
                            <p class="text-base text-gray-700 leading-relaxed font-medium">Neural link established. How
                                can
                                I assist you in this <span
                                    class="active-mode-name-label font-semibold text-gray-900">specialized
                                    sub-routine</span>?
                            </p>
                        </div>
                    </div>
                    <div class="flex flex-col md:flex-row gap-4 items-stretch">
                        <input type="text" id="chatInputWorkspace" placeholder="Broadcast to Daisy..."
                            class="nw-input focus:outline-none focus:ring-8 ring-black/5 transition-all">
                        <button id="chatSendBtnWorkspace"
                            class="nw-send bg-black text-white hover:bg-gray-800 transition-all haptic-pop flex items-center justify-center gap-3">
                            Sync <i data-lucide="arrow-right" class="w-5 h-5"></i>
                        </button>
                    </div>
                </section>
            </div>
        </div>
    </div>







    <script>
        // Generate mini squares for phone preview
        function generateMiniSquares() {
            const levels = [0, 0, 1, 0, 2, 0, 1, 3, 0, 1, 2, 0, 0, 1, 0, 2, 1, 0, 3, 0, 0];
            return levels.map((level, i) => {
                const colors = ['', '#9be9a8', '#40c463', '#30a14e', '#216e39'];
                const bg = level === 0 ? 'rgba(0,0,0,0.06)' : colors[level];
                return `<div style="aspect-ratio:1; border-radius:2px; background:${bg}"></div>`;
            }).join('');
        }

        // Open full Pomodoro panel
        function openFullPomodoro() {
            const workspace = document.getElementById('neuralWorkspace');
            const loader = document.getElementById('neuralLoader');
            const focusPanel = document.getElementById('focusModePanel');

            if (loader) {
                loader.querySelector('p').textContent = "Launching Focus Mode...";
                loader.classList.add('active');
            }

            setTimeout(() => {
                if (workspace) workspace.classList.add('active');
                if (focusPanel) focusPanel.classList.remove('hidden');
                if (loader) loader.classList.remove('active');
                document.body.style.overflow = 'hidden';
                PomoTimer.init();
            }, 800);
        }

        // Pomodoro Timer Module
        const PomoTimer = {
            isRunning: false,
            isMusicPlaying: false,
            theme: 'light', // 'light', 'dark', 'ice'
            audioCtx: null,

            init() {
                this.loadData();
                this.renderSquares();
                this.updateUI();
                this.initNotes();
                this.initShortcuts();
                this.renderTimeline();
            },

            initAudio() {
                if (this.audioCtx) return;
                this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            },

            playSound(type) {
                try {
                    this.initAudio();
                    const osc = this.audioCtx.createOscillator();
                    const gain = this.audioCtx.createGain();

                    osc.connect(gain);
                    gain.connect(this.audioCtx.destination);

                    const now = this.audioCtx.currentTime;

                    if (type === 'play') {
                        // Rising Apple-style Zen chime
                        osc.type = 'sine';
                        osc.frequency.setValueAtTime(880, now); // A5
                        osc.frequency.exponentialRampToValueAtTime(1320, now + 0.1); // E6
                        gain.gain.setValueAtTime(0, now);
                        gain.gain.linearRampToValueAtTime(0.2, now + 0.05);
                        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
                        osc.start(now);
                        osc.stop(now + 0.3);
                    } else if (type === 'pause') {
                        // Soft descending "hush" tone
                        osc.type = 'triangle';
                        osc.frequency.setValueAtTime(440, now); // A4
                        osc.frequency.exponentialRampToValueAtTime(330, now + 0.1); // E4
                        gain.gain.setValueAtTime(0, now);
                        gain.gain.linearRampToValueAtTime(0.15, now + 0.05);
                        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.2);
                        osc.start(now);
                        osc.stop(now + 0.2);
                    }
                } catch (err) {
                    console.log('Audio blocked or failed:', err);
                }
            },
            currentMode: 'focus', // 'focus', 'short', 'long'
            durations: { focus: 25, short: 5, long: 15 },
            timeRemaining: 25 * 60, // in seconds
            totalDuration: 25 * 60,
            interval: null,
            sessionsCompleted: 0,
            totalFocusMinutes: 0,
            streak: 0,
            todaySessions: 0,
            todayMinutes: 0,
            dailyGoal: 4,
            history: [], // Array of { date: 'YYYY-MM-DD', sessions: number }
            sessionLogs: [], // Array of { timestamp: string, mode: string, duration: number, notes: string }

            init() {
                this.loadData();
                this.renderSquares();
                this.updateUI();
                this.initNotes();
                this.renderTimeline();
                this.applyTheme();

                // Add layout class for perfect fullscreen
                document.getElementById('neuralWorkspace')?.classList.add('pomo-active');
            },

            loadData() {
                try {
                    const saved = localStorage.getItem('pomo_data');
                    if (saved) {
                        const data = JSON.parse(saved);
                        this.sessionsCompleted = data.sessionsCompleted || 0;
                        this.totalFocusMinutes = data.totalFocusMinutes || 0;
                        this.streak = data.streak || 0;
                        this.history = data.history || [];
                        this.sessionLogs = data.sessionLogs || [];
                        this.theme = data.theme || (data.isDarkMode ? 'dark' : 'light');

                        // Check today's data
                        const today = new Date().toISOString().slice(0, 10);
                        const todayData = this.history.find(h => h.date === today);
                        if (todayData) {
                            this.todaySessions = todayData.sessions;
                            this.todayMinutes = todayData.minutes || 0;
                        }
                    }
                } catch (e) {
                    console.log('Error loading pomo data');
                }
            },

            saveData() {
                const data = {
                    sessionsCompleted: this.sessionsCompleted,
                    totalFocusMinutes: this.totalFocusMinutes,
                    streak: this.streak,
                    history: this.history,
                    sessionLogs: this.sessionLogs,
                    theme: this.theme
                };
                localStorage.setItem('pomo_data', JSON.stringify(data));
            },

            toggleMusic() {
                const isActive = this.isMusicPlaying;

                if (!isActive) {
                    this.isMusicPlaying = true;
                    this.updateMusicUI(true);
                    SoundEngine.play();
                    // Setup progress callback
                    SoundEngine.onProgress = (cur, dur) => {
                        this.updateMusicProgress(cur, dur);
                    };
                } else {
                    this.isMusicPlaying = false;
                    this.updateMusicUI(false);
                    SoundEngine.stop();
                }
            },

            nextTrack() {
                let next = SoundEngine.currentTrackIndex + 1;
                if (next >= SoundEngine.playlist.length) next = 0;
                SoundEngine.play(next);
                this.isMusicPlaying = true;
                this.updateMusicUI(true);
            },

            prevTrack() {
                let prev = SoundEngine.currentTrackIndex - 1;
                if (prev < 0) prev = SoundEngine.playlist.length - 1;
                SoundEngine.play(prev);
                this.isMusicPlaying = true;
                this.updateMusicUI(true);
            },

            seekMusic(e) {
                const rect = e.currentTarget.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const percent = (x / rect.width) * 100;
                SoundEngine.seek(percent);
            },

            updateMusicProgress(cur, dur) {
                const progress = document.getElementById('pomoMusicProgress');
                const time = document.getElementById('pomoMusicTime');
                if (progress) progress.style.width = `${(cur / dur) * 100}%`;
                if (time) {
                    const mins = Math.floor(cur / 60);
                    const secs = Math.floor(cur % 60);
                    time.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                }
            },

            updateMusicUI(isPlaying) {
                const icon = document.getElementById('pomoMusicIcon');
                const toggle = document.getElementById('pomoMusicToggle');
                if (icon) {
                    icon.innerHTML = isPlaying ?
                        '<rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>' :
                        '<path d="M8 5v14l11-7z"/>';
                }
                if (toggle) {
                    if (isPlaying) toggle.classList.add('active');
                    else toggle.classList.remove('active');
                }
            },

            saveLog() {
                const notesEl = document.getElementById('pomoNotesTextarea');
                const notes = notesEl?.value || '';
                const log = {
                    timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                    mode: this.currentMode,
                    duration: this.durations[this.currentMode],
                    notes: notes.trim()
                };
                this.sessionLogs.unshift(log); // Newest first
                if (this.sessionLogs.length > 10) this.sessionLogs.pop(); // Keep last 10
                this.saveData();
                this.renderTimeline();
                this.clearNotes();
            },

            renderTimeline() {
                const container = document.getElementById('pomoTimeline');
                if (!container) return;

                if (this.sessionLogs.length === 0) {
                    container.innerHTML = '<div class="pomo-log-item"><div class="pomo-log-text opacity-40">Your productivity timeline will appear here...</div></div>';
                    return;
                }

                container.innerHTML = this.sessionLogs.map(log => `
                    <div class="pomo-log-item">
                        <div class="pomo-log-dot"></div>
                        <div class="pomo-log-time">${log.timestamp}</div>
                        <div class="pomo-log-meta">${log.mode.charAt(0).toUpperCase() + log.mode.slice(1)}  ${log.duration}m</div>
                        <div class="pomo-log-text">${log.notes}</div>
                    </div>
                `).join('');
            },

            toggleTheme() {
                const themes = ['light', 'dark', 'ice', 'sunset', 'forest', 'cyber', 'lavender', 'nordic', 'arctic', 'luxury', 'matrix', 'rose', 'stealth'];
                const currentIndex = themes.indexOf(this.theme);
                this.theme = themes[(currentIndex + 1) % themes.length];
                this.applyTheme();
                this.saveData();
            },

            applyTheme() {
                const container = document.getElementById('focusModePanel');
                if (container) {
                    container.classList.remove('dark-mode', 'ice-mode', 'sunset-mode', 'forest-mode', 'cyber-mode', 'lavender-mode', 'nordic-mode', 'arctic-mode', 'luxury-mode', 'matrix-mode', 'rose-mode', 'stealth-mode');
                    if (this.theme !== 'light') container.classList.add(`${this.theme}-mode`);
                }
                const icon = document.getElementById('pomoThemeIcon');
                if (icon) {
                    const icons = {
                        light: '<path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707.707M6.364 17.364l-.707.707M6.364 6.364l-.707-.707m12.728 12.728l-.707-.707M12 8a4 4 0 100 8 4 4 0 000-8z" />',
                        dark: '<path d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />',
                        ice: '<path d="M12 3v18m9-9H3m15.364-6.364l-12.728 12.728M18.364 17.364L5.636 4.636" />',
                        sunset: '<path d="M17 18a5 5 0 00-10 0M12 2v1M4.22 4.22l.71.71M2 12h1M4.22 19.78l.71-.71M22 12h-1M19.78 19.78l-.71-.71M19.78 4.22l-.71.71" />',
                        forest: '<path d="M12 2L8 8h3v11h2V8h3l-4-6zM3 21h18" />',
                        cyber: '<path d="M4 17h16M4 12h16M4 7h16" />',
                        lavender: '<path d="M17.5 19c.7 0 1.2-.5 1.2-1.2 0-1.5-3.5-4.8-3.5-4.8s-3.5 3.3-3.5 4.8c0 .7.5 1.2 1.2 1.2h4.6zM6.5 19c.7 0 1.2-.5 1.2-1.2 0-1.5-3.5-4.8-3.5-4.8s-3.5 3.3-3.5 4.8c0 .7.5 1.2 1.2 1.2h4.6z" />',
                        nordic: '<path d="M12 2l8 4-8 4-8-4 8-4zM4 10v12l8 4 8-4V10" />',
                        arctic: '<path d="M12 2L2 22h20L12 2zM12 8l4 8h-8l4-8z" />',
                        luxury: '<path d="M12 2l4 8-4 12-4-12 4-8zM4 10h16" />',
                        matrix: '<path d="M4 4h16l-8 8-8-8zM4 20h16l-8-8-8 8z" />',
                        rose: '<path d="M12 2s-5 4-5 9a5 5 0 0010 0c0-5-5-9-5-9z" />',
                        stealth: '<path d="M12 2a10 10 0 100 20 10 10 0 000-20zm0 18a8 8 0 110-16 8 8 0 010 16z" />'
                    };
                    icon.innerHTML = icons[this.theme] || icons.light;
                }
            },



            setMode(mode) {
                this.currentMode = mode;
                this.timeRemaining = this.durations[mode] * 60;
                this.totalDuration = this.timeRemaining;
                this.isRunning = false;
                if (this.interval) clearInterval(this.interval);
                this.updateUI();
                this.updateModeTabs();
            },

            setDuration(minutes) {
                this.durations.focus = minutes;
                if (this.currentMode === 'focus') {
                    this.timeRemaining = minutes * 60;
                    this.totalDuration = this.timeRemaining;
                }
                this.updateUI();
                this.updateQuickBtns(minutes);
            },

            updateQuickBtns(active) {
                document.querySelectorAll('.pomo-quick-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.textContent === active + 'm') btn.classList.add('active');
                });
            },

            updateModeTabs() {
                document.querySelectorAll('.pomo-mode-tab').forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.textContent.toLowerCase().includes(this.currentMode)) {
                        tab.classList.add('active');
                    }
                });
            },

            toggle() {
                if (this.isRunning) {
                    this.pause();
                } else {
                    this.start();
                }
            },

            start() {
                if (this.isRunning) return;
                this.isRunning = true;
                this.initAudio();
                this.playSound('play');
                document.getElementById('focusModePanel')?.classList.add('timer-active');
                this.updatePlayButton();
                this.interval = setInterval(() => this.tick(), 1000);
            },

            pause() {
                if (!this.isRunning) return;
                this.isRunning = false;
                this.playSound('pause');
                document.getElementById('focusModePanel')?.classList.remove('timer-active');
                this.updatePlayButton();
                if (this.interval) clearInterval(this.interval);
            },

            reset() {
                this.isRunning = false;
                document.getElementById('focusModePanel')?.classList.remove('timer-active');
                if (this.interval) clearInterval(this.interval);
                this.timeRemaining = this.durations[this.currentMode] * 60;
                this.updateUI();
                this.updatePlayButton();
            },

            skip() {
                this.onComplete();
            },

            tick() {
                if (this.timeRemaining > 0) {
                    this.timeRemaining--;
                    this.updateUI();
                } else {
                    this.onComplete();
                }
            },

            onComplete() {
                this.reset();

                // Trigger Victory Glow
                const aura = document.getElementById('pomoVictoryAura');
                if (aura) {
                    aura.classList.remove('animate');
                    void aura.offsetWidth; // Force reflow
                    aura.classList.add('animate');
                }

                // Show notification
                if (this.currentMode === 'focus') {
                    this.sessionsCompleted++;
                    this.totalFocusMinutes += this.durations.focus;
                    this.todaySessions++;
                    this.todayMinutes += this.durations.focus;

                    // Update history
                    const today = new Date().toISOString().slice(0, 10);
                    const todayIdx = this.history.findIndex(h => h.date === today);
                    if (todayIdx >= 0) {
                        this.history[todayIdx].sessions++;
                        this.history[todayIdx].minutes = (this.history[todayIdx].minutes || 0) + this.durations.focus;
                    } else {
                        this.history.push({ date: today, sessions: 1, minutes: this.durations.focus });
                    }

                    // Update streak
                    this.updateStreak();
                    this.saveLog(); // Save session log
                    this.saveData();
                    this.renderSquares();

                    // Show notification
                    if ('Notification' in window && Notification.permission === 'granted') {
                        new Notification('Focus Session Complete!', { body: 'Time for a break!' });
                    }

                    // Switch to break
                    this.setMode(this.sessionsCompleted % 4 === 0 ? 'long' : 'short');
                } else {
                    // Break complete, switch to focus
                    this.setMode('focus');
                }
            },

            updateStreak() {
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toISOString().slice(0, 10);

                const hadSessionYesterday = this.history.some(h => h.date === yesterdayStr);
                if (hadSessionYesterday || this.streak === 0) {
                    this.streak++;
                }
            },

            updateUI() {
                const mins = Math.floor(this.timeRemaining / 60);
                const secs = this.timeRemaining % 60;
                const timeStr = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

                // Update time display
                const timeEl = document.getElementById('pomoTimeDisplay');
                if (timeEl) timeEl.textContent = timeStr;

                // Zen Mode (Focus Fade)
                const container = document.getElementById('focusModePanel');
                if (container) {
                    if (this.isRunning) {
                        container.classList.add('pomo-running');
                    } else {
                        container.classList.remove('pomo-running');
                    }
                }

                // Update session label
                const labelEl = document.getElementById('pomoSessionLabel');
                if (labelEl) {
                    const labels = { focus: 'Focus Session', short: 'Short Break', long: 'Long Break' };
                    labelEl.textContent = labels[this.currentMode];
                }

                // Update stats
                const sessionCount = document.getElementById('pomoSessionCount');
                if (sessionCount) sessionCount.textContent = this.sessionsCompleted;

                // Update Liquid Core
                const liquid = document.getElementById('pomoLiquidFill');
                if (liquid) {
                    const total = this.durations[this.currentMode] * 60;
                    const percent = ((total - this.timeRemaining) / total) * 100;
                    liquid.style.height = `${percent}%`;
                }
                const totalTime = document.getElementById('pomoTotalTime');
                if (totalTime) totalTime.textContent = this.totalFocusMinutes + 'm';

                const streakEl = document.getElementById('pomoStreak');
                if (streakEl) streakEl.textContent = this.streak;

                // Update today's stats
                const todaySessionsEl = document.getElementById('pomoTodaySessions');
                if (todaySessionsEl) todaySessionsEl.textContent = this.todaySessions;

                const todayMinutesEl = document.getElementById('pomoTodayMinutes');
                if (todayMinutesEl) todayMinutesEl.textContent = this.todayMinutes;

                const todayGoalEl = document.getElementById('pomoTodayGoal');
                if (todayGoalEl) {
                    const pct = Math.min(100, Math.round((this.todaySessions / this.dailyGoal) * 100));
                    todayGoalEl.textContent = pct + '%';
                }

                // Update contrib count
                const contribCount = document.getElementById('pomoContribCount');
                if (contribCount) {
                    const total = this.history.reduce((sum, h) => sum + h.sessions, 0);
                    contribCount.textContent = total + ' sessions';
                }
            },

            updatePlayButton() {
                const btn = document.getElementById('pomoPlayBtn');
                const icon = document.getElementById('pomoPlayIcon');
                if (icon) {
                    if (this.isRunning) {
                        icon.innerHTML = '<rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>';
                    } else {
                        icon.innerHTML = '<path d="M8 5v14l11-7z"/>';
                    }
                }
                if (btn) {
                    if (this.currentMode !== 'focus') {
                        btn.classList.add('break-mode');
                    } else {
                        btn.classList.remove('break-mode');
                    }
                }
            },

            renderSquares() {
                const grid = document.getElementById('pomoSquaresGrid');
                if (!grid) return;

                grid.innerHTML = '';
                const today = new Date();

                // Generate last 35 days (5 weeks)
                for (let i = 34; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().slice(0, 10);

                    const dayData = this.history.find(h => h.date === dateStr);
                    const sessions = dayData ? dayData.sessions : 0;

                    let level = 0;
                    if (sessions >= 6) level = 4;
                    else if (sessions >= 4) level = 3;
                    else if (sessions >= 2) level = 2;
                    else if (sessions >= 1) level = 1;

                    const square = document.createElement('div');
                    square.className = 'pomo-square' + (level > 0 ? ` level-${level}` : '');
                    if (i === 0) square.classList.add('today');
                    square.title = `${dateStr}: ${sessions} sessions`;
                    grid.appendChild(square);
                }
            },

            initNotes() {
                const notesEl = document.getElementById('pomoNotesTextarea');
                const key = 'pomo_notes';
                if (!notesEl) return;
                notesEl.value = localStorage.getItem(key) || '';
                notesEl.addEventListener('input', () => {
                    localStorage.setItem(key, notesEl.value);
                });
            },

            clearNotes() {
                const notesEl = document.getElementById('pomoNotesTextarea');
                if (notesEl) {
                    notesEl.value = '';
                    localStorage.removeItem('pomo_notes');
                }
            },

            initShortcuts() {
                if (this.shortcutsInitialized) return;
                document.addEventListener('keydown', (e) => this.handleKeyPress(e));

                // Add mouse tracking for spotlight
                const container = document.getElementById('focusModePanel');
                if (container) {
                    container.addEventListener('mousemove', (e) => {
                        const spotlight = document.getElementById('pomoSpotlight');
                        if (spotlight) {
                            const rect = container.getBoundingClientRect();
                            spotlight.style.left = `${e.clientX - rect.left}px`;
                            spotlight.style.top = `${e.clientY - rect.top}px`;
                        }
                    });
                }
                this.shortcutsInitialized = true;
            },

            handleKeyPress(e) {
                // 1. Only work when focus panel is active
                const focusPanel = document.getElementById('focusModePanel');
                if (!focusPanel || focusPanel.classList.contains('hidden')) return;

                // 2. Ignore if typing in text fields
                const target = e.target;
                if (target.tagName === 'TEXTAREA' || target.tagName === 'INPUT' || target.isContentEditable) return;

                const key = e.key; // Primary
                const code = e.code; // Fallback for specific physical keys

                // Toggle Start/Pause (Space)
                if (key === ' ' || code === 'Space') {
                    e.preventDefault();
                    this.toggle();
                }
                // Reset (R)
                else if (key === 'r' || key === 'R' || code === 'KeyR') {
                    if (confirm('Reset current session?')) this.reset();
                }
                // Dark Mode Toggle (T)
                else if (key === 't' || key === 'T' || code === 'KeyT') {
                    this.toggleTheme();
                }
                // Focus Notes (N)
                else if (key === 'n' || key === 'N' || code === 'KeyN') {
                    e.preventDefault();
                    const notes = document.getElementById('pomoNotesTextarea');
                    if (notes) notes.focus();
                }
                // Switch Modes (1, 2, 3)
                else if (key === '1' || code === 'Digit1') {
                    this.setMode('focus');
                } else if (key === '2' || code === 'Digit2') {
                    this.setMode('short');
                } else if (key === '3' || code === 'Digit3') {
                    this.setMode('long');
                }
            }
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
            // Init shortcuts immediately
            PomoTimer.initShortcuts();
        });
    </script>
</body>

</html>